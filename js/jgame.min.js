var jg;
(function(e){var c=function(a){void 0===a&&(a=(new Date).getTime());this._mt=Array(624);this.setSeed(a)};c._mulUint32=function(a,d){var b=a&65535,f=d&65535;return((a>>16)*f+b*(d>>16)<<16)+b*f};c.prototype.setSeed=function(a){var d=this._mt;if("number"==typeof a){d[0]=a;for(var b=1;b<d.length;b++){var f=d[b-1]^d[b-1]>>30;d[b]=c._mulUint32(1812433253,f)+b}this._index=d.length}else if(a instanceof Array){var b=1,g=0;this.setSeed(19650218);for(var e=Math.max(d.length,a.length);0<e;e--)f=d[b-1]^d[b-1]>>
30,f=c._mulUint32(f,1664525),d[b]=(d[b]^f)+a[g]+g,++b>=d.length&&(d[0]=d[d.length-1],b=1),++g>=a.length&&(g=0);for(e=d.length-1;0<e;e--)f=d[b-1]^d[b-1]>>30,f=c._mulUint32(f,1566083941),d[b]=(d[b]^f)-b,++b>=d.length&&(d[0]=d[d.length-1],b=1);d[0]=2147483648}else throw new TypeError("MersenneTwister: illegal seed.");};c.prototype._nextInt=function(){var a=this._mt,d;if(this._index>=a.length){var b=0,f=a.length;do d=a[b]&2147483648|a[b+1]&2147483647,a[b]=a[b+397]^d>>1^(d&1?2567483615:0);while(++b<f-
397);do d=a[b]&2147483648|a[b+1]&2147483647,a[b]=a[b+397-f]^d>>1^(d&1?2567483615:0);while(++b<f-1);d=a[f-1]&2147483648|a[0]&2147483647;a[f-1]=a[396]^d>>1^(d&1?2567483615:0);this._index=0}d=a[this._index++];d^=d>>11;d^=d<<7&2636928640;d^=d<<15&4022730752;return d^d>>18};c.prototype.next=function(){var a=this._nextInt()>>5,d=this._nextInt()>>6;return(67108864*a+d)/4503599627370496};c.prototype.nextInt=function(a,d){if(!(0<d&&4294967296>d))return this._nextInt()+a;if((d&~d+1)==d)return(d-1&this._nextInt())+
a;var b;do b=this._nextInt();while(d>2147483647-(b-(b%=d)));return b+a};e.MT=c})(jg||(jg={}));
(function(e){var c=e.Angle||(e.Angle={});c._map=[];c._map[0]="Unknown";c.Unknown=0;c._map[1]="Left";c.Left=1;c._map[2]="Right";c.Right=2;c._map[3]="Up";c.Up=3;c._map[4]="Down";c.Down=4;c=e.RenderTransferMode||(e.RenderTransferMode={});c._map=[];c._map[0]="Unknown";c.Unknown=0;c._map[1]="Transfer";c.Transfer=1;c._map[2]="Flip";c.Flip=2;c._map[3]="Direct";c.Direct=3;c=e.InputEventType||(e.InputEventType={});c._map=[];c._map[0]="Unknown";c.Unknown=0;c._map[1]="Keyboard";c.Keyboard=1;c._map[2]="Point";
c.Point=2;c=e.InputEventAction||(e.InputEventAction={});c._map=[];c._map[0]="Unknown";c.Unknown=0;c._map[1]="Down";c.Down=1;c._map[2]="Move";c.Move=2;c._map[3]="Up";c.Up=3;c=e.Keytype||(e.Keytype={});c._map=[];c._map[0]="Unknown";c.Unknown=0;c._map[1]="Left";c.Left=1;c._map[2]="Right";c.Right=2;c._map[3]="Up";c.Up=3;c._map[4]="Down";c.Down=4;c._map[5]="Enter";c.Enter=5;c._map[6]="Esc";c.Esc=6;c=e.ShapeStyle||(e.ShapeStyle={});c._map=[];c._map[0]="Unknown";c.Unknown=0;c._map[1]="Stroke";c.Stroke=1;
c._map[2]="Fill";c.Fill=2;c=e.ShapeType||(e.ShapeType={});c._map=[];c._map[0]="Unknown";c.Unknown=0;c._map[1]="Rect";c.Rect=1;c._map[2]="Arc";c.Arc=2;e=e.EffectType||(e.EffectType={});e._map=[];e._map[0]="None";e.None=0;e._map[1]="Fade";e.Fade=1;e._map[2]="Mosaic";e.Mosaic=2;e._map[3]="Blur";e.Blur=3;e._map[4]="SlideUp";e.SlideUp=4;e._map[5]="SlideDown";e.SlideDown=5;e._map[6]="SlideLeft";e.SlideLeft=6;e._map[7]="SlideRight";e.SlideRight=7;e._map[8]="WipeUp";e.WipeUp=8;e._map[9]="WipeDown";e.WipeDown=
9;e._map[10]="WipeLeft";e.WipeLeft=10;e._map[11]="WipeRight";e.WipeRight=11;e._map[12]="WipeFadeUp";e.WipeFadeUp=12;e._map[13]="WipeFadeDown";e.WipeFadeDown=13;e._map[14]="WipeFadeLeft";e.WipeFadeLeft=14;e._map[15]="WipeFadeRight";e.WipeFadeRight=15;e._map[16]="BoxOut";e.BoxOut=16;e._map[17]="BoxOut45";e.BoxOut45=17;e._map[18]="BoxIn";e.BoxIn=18;e._map[19]="BoxIn45";e.BoxIn45=19;e._map[20]="ArcOut";e.ArcOut=20;e._map[21]="ArcIn";e.ArcIn=21;e._map[22]="BoxOutBlack";e.BoxOutBlack=22;e._map[23]="BoxOut45Black";
e.BoxOut45Black=23;e._map[24]="BoxInBlack";e.BoxInBlack=24;e._map[25]="BoxIn45Black";e.BoxIn45Black=25;e._map[26]="ArcOutBlack";e.ArcOutBlack=26;e._map[27]="ArcInBlack";e.ArcInBlack=27;e._map[28]="BoxOutWhite";e.BoxOutWhite=28;e._map[29]="BoxOut45White";e.BoxOut45White=29;e._map[30]="BoxInWhite";e.BoxInWhite=30;e._map[31]="BoxIn45White";e.BoxIn45White=31;e._map[32]="ArcOutWhite";e.ArcOutWhite=32;e._map[33]="ArcInWhite";e.ArcInWhite=33})(jg||(jg={}));
window.requestAnimationFrame=window.requestAnimationFrame||window.mozRequestAnimationFrame||window.webkitRequestAnimationFrame||window.msRequestAnimationFrame||function(){var e=Date.now?Date.now():(new Date).getTime(),c=1E3/60;return function(a){var d=Date.now?Date.now():(new Date).getTime(),b=setTimeout(function(){a(Date.now?Date.now():(new Date).getTime())},Math.max(0,e+c-d));e=d;return b}}();
window.createCanvas=function(e,c){var a=document.createElement("canvas");a.width=e;a.height=c;if("imageSmoothingEnabled"in window){var d=jg.JGUtil.getBrowser();d.opera?a.style.imageRendering="-o-crisp-edges":d.msie?a.style.msInterpolationMode="nearest-neighbor":d.safari&&(a.style.imageRendering="-webkit-optimize-contrast");d=a.getContext("2d");d.imageSmoothingEnabled&&(d.imageSmoothingEnabled=!1);d.webkitImageSmoothingEnabled&&(d.webkitImageSmoothingEnabled=!1);d.mozImageSmoothingEnabled&&(d.mozImageSmoothingEnabled=
!1)}return a};
(function(e){var c=function(a,d,b,f){this.left=a;this.top=d;this.right=b;this.bottom=f};c.prototype.hitTest=function(a){return this.left<=a.x&&this.right>=a.x&&this.top<=a.y&&this.bottom>=a.y};c.prototype.fit=function(a){a.y<this.top?a.y=this.top:a.y>this.bottom&&(a.y=this.bottom);a.x<this.left?a.x=this.left:a.x>this.right&&(a.x=this.right)};c.prototype.width=function(){return Math.abs(this.right-this.left)};c.prototype.height=function(){return Math.abs(this.bottom-this.top)};e.Rectangle=c})(jg||
(jg={}));
(function(e){var c=function(){};c.LINEAR=function(a,d,b,f){return b*a/f+d};c.SWING=function(a,d,b,f){return b*(0.5-Math.cos(a/f*Math.PI)/2)+d};c.QUAD_EASEIN=function(a,d,b,f){return b*(a/=f)*a+d};c.QUAD_EASEOUT=function(a,d,b,f){return-b*(a/=f)*(a-2)+d};c.QUAD_EASEINOUT=function(a,d,b,f){return 1>(a/=f/2)?b/2*a*a+d:-b/2*(--a*(a-2)-1)+d};c.CUBIC_EASEIN=function(a,d,b,f){return b*(a/=f)*a*a+d};c.CUBIC_EASEOUT=function(a,d,b,f){return b*((a=a/f-1)*a*a+1)+d};c.CUBIC_EASEINOUT=function(a,d,b,f){return 1>
(a/=f/2)?b/2*a*a*a+d:b/2*((a-=2)*a*a+2)+d};c.QUART_EASEIN=function(a,d,b,f){return b*(a/=f)*a*a*a+d};c.QUART_EASEOUT=function(a,d,b,f){return-b*((a=a/f-1)*a*a*a-1)+d};c.QUART_EASEINOUT=function(a,d,b,f){return 1>(a/=f/2)?b/2*a*a*a*a+d:-b/2*((a-=2)*a*a*a-2)+d};c.QUINT_EASEIN=function(a,d,b,f){return b*(a/=f)*a*a*a*a+d};c.QUINT_EASEOUT=function(a,d,b,f){return b*((a=a/f-1)*a*a*a*a+1)+d};c.QUINT_EASEINOUT=function(a,d,b,f){return 1>(a/=f/2)?b/2*a*a*a*a*a+d:b/2*((a-=2)*a*a*a*a+2)+d};c.SIN_EASEIN=function(a,
d,b,f){return-b*Math.cos(a/f*(Math.PI/2))+b+d};c.SIN_EASEOUT=function(a,d,b,f){return b*Math.sin(a/f*(Math.PI/2))+d};c.SIN_EASEINOUT=function(a,d,b,f){return-b/2*(Math.cos(Math.PI*a/f)-1)+d};c.CIRC_EASEIN=function(a,d,b,f){return-b*(Math.sqrt(1-(a/=f)*a)-1)+d};c.CIRC_EASEOUT=function(a,d,b,f){return b*Math.sqrt(1-(a=a/f-1)*a)+d};c.CIRC_EASEINOUT=function(a,d,b,f){return 1>(a/=f/2)?-b/2*(Math.sqrt(1-a*a)-1)+d:b/2*(Math.sqrt(1-(a-=2)*a)+1)+d};c.ELASTIC_EASEIN=function(a,d,b,f,g,c){if(0===a)return d;
if(1===(a/=f))return d+b;c||(c=0.3*f);!g||g<Math.abs(b)?(g=b,b=c/4):b=c/(2*Math.PI)*Math.asin(b/g);return-(g*Math.pow(2,10*(a-=1))*Math.sin((a*f-b)*2*Math.PI/c))+d};c.ELASTIC_EASEOUT=function(a,d,b,f,g,c){if(0===a)return d;if(1===(a/=f))return d+b;c||(c=0.3*f);var e;!g||g<Math.abs(b)?(g=b,e=c/4):e=c/(2*Math.PI)*Math.asin(b/g);return g*Math.pow(2,-10*a)*Math.sin((a*f-e)*2*Math.PI/c)+b+d};c.ELASTIC_EASEINOUT=function(a,d,b,f,g,c){if(0===a)return d;if(2===(a/=f/2))return d+b;c||(c=f*0.3*1.5);var e;!g||
g<Math.abs(b)?(g=b,e=c/4):e=c/(2*Math.PI)*Math.asin(b/g);return 1>a?-0.5*g*Math.pow(2,10*(a-=1))*Math.sin((a*f-e)*2*Math.PI/c)+d:0.5*g*Math.pow(2,-10*(a-=1))*Math.sin((a*f-e)*2*Math.PI/c)+b+d};c.BOUNCE_EASEOUT=function(a,d,b,f){return(a/=f)<1/2.75?b*7.5625*a*a+d:a<2/2.75?b*(7.5625*(a-=1.5/2.75)*a+0.75)+d:a<2.5/2.75?b*(7.5625*(a-=2.25/2.75)*a+0.9375)+d:b*(7.5625*(a-=2.625/2.75)*a+0.984375)+d};c.BOUNCE_EASEIN=function(a,d,b,f){return b-c.BOUNCE_EASEOUT(f-a,0,b,f)+d};c.BOUNCE_EASEINOUT=function(a,d,
b,f){return a<f/2?0.5*c.BOUNCE_EASEIN(2*a,0,b,f)+d:0.5*c.BOUNCE_EASEOUT(2*a-f,0,b,f)+0.5*b+d};c.BACK_EASEIN=function(a,d,b,f,g){void 0===g&&(g=1.70158);return b*(a/=f)*a*((g+1)*a-g)+d};c.BACK_EASEOUT=function(a,d,b,f,g){void 0===g&&(g=1.70158);return b*((a=a/f-1)*a*((g+1)*a+g)+1)+d};c.BACK_EASEINOUT=function(a,d,b,f,g){void 0===g&&(g=1.70158);return 1>(a/=f/2)?b/2*a*a*(((g*=1.525)+1)*a-g)+d:b/2*((a-=2)*a*(((g*=1.525)+1)*a+g)+2)+d};c.EXPO_EASEIN=function(a,d,b,f){return 0===a?d:b*Math.pow(2,10*(a/
f-1))+d};c.EXPO_EASEOUT=function(a,d,b,f){return a===f?d+b:b*(-Math.pow(2,-10*a/f)+1)+d};c.EXPO_EASEINOUT=function(a,d,b,f){return 0===a?d:a===f?d+b:1>(a/=f/2)?b/2*Math.pow(2,10*(a-1))+d:b/2*(-Math.pow(2,-10*--a)+2)+d};e.Easing=c})(jg||(jg={}));
(function(e){e.ENTITY_OPTIONS_DEFAULT_VALUES={rotate:0,translate:{x:0,y:0},transform:{m11:1,m12:0,m21:0,m22:1,dx:0,dy:0},scale:{x:1,y:1},globalAlpha:void 0,font:void 0,fillStyle:void 0,strokeStyle:void 0,lineCap:void 0,lineJoin:void 0,lineWidth:void 0,miterLimit:void 0,shadowBlur:void 0,shadowColor:void 0,shadowOffsetX:void 0,shadowOffsetY:void 0,strokeStyle:void 0,textAlign:void 0,textBaseline:void 0,globalCompositeOperation:void 0};var c=function(){this.opacity=1;this.y=this.x=0};c.prototype.enablePointingEvent=
function(){this.pointCapture=!0;this.pointDown||(this.pointDown=new e.Trigger);this.pointUp||(this.pointUp=new e.Trigger);this.pointMove||(this.pointMove=new e.Trigger)};c.prototype.disablePointingEvent=function(){delete this.pointCapture};c.prototype.removeDrawOption=function(a){if(this.options){void 0!==this.options[a]&&delete this.options[a];a=0;for(var d in this.options){a++;break}a||delete this.options;this.updated()}};c.prototype.setDrawOption=function(a,d){this.options||(this.options={});this.options[a]=
d;this.updated()};c.prototype.getDrawOption=function(a){return!this.options||void 0==this.options[a]?e.ENTITY_OPTIONS_DEFAULT_VALUES[a]:this.options[a]};c.prototype.moveTo=function(a,d){this.x=a;this.y=d;this.updated()};c.prototype.moveBy=function(a,d){this.x+=a;this.y+=d;this.updated()};c.prototype.scrollTo=function(a,d){this.scroll={x:a,y:d};this.updated()};c.prototype.scrollBy=function(a,d){this.scroll||(this.scroll={x:0,y:0});this.scroll.x+=a;this.scroll.y+=d;this.updated()};c.prototype.activate=
function(){if(this.active_queue){for(var a;a=this.active_queue.shift();)a.call(this);delete this.active_queue}if(this.entities)for(a=0;a<this.entities.length;a++)this.entities[a].scene||(this.entities[a].scene=this.scene,this.entities[a].activate())};c.prototype.addActiveQueue=function(a){this.scene?a.call(this):(this.active_queue||(this.active_queue=[]),this.active_queue.push(a))};c.prototype.appendTo=function(a,d){a.append(this,d)};c.prototype.remove=function(){if(this.parent)this.parent.removeChild(this);
else throw"Can not remove layer. (use scene.deleteLayer)";};c.prototype.insert=function(a,d){if(!this.entities)throw"Can not call append of non-container entity";a.scene=this.scene;a.parent=this;if("number"!=typeof d)for(var b=0;b<this.entities.length;b++)if(this.entities[b]==d){d=b;break}this.entities.splice(d,0,a);a.activate();this.updated()};c.prototype.append=function(a){if(!this.entities)throw"Can not call append of non-container entity";a.scene=this.scene;a.parent=this;this.entities.push(a);
this.scene&&a.activate();this.updated()};c.prototype.removeChild=function(a){if(!this.entities)throw"Can not call removeChild of non-container entity";for(var d=0;d<this.entities.length;d++)if(this.entities[d]==a){if(a.entities)for(var b;b=a.entities.pop();)a.removeChild(b);this.entities.splice(d,1);a.destroy();this.updated();return!0}return!1};c.prototype.start=function(){this.started||(this.started=!0,this.scene?this.scene.game.update.handle(this,this.update):this.addActiveQueue(function(){this.scene.game.update.handle(this,
this.update)}))};c.prototype.stop=function(){this.started&&(this.started=!1,this.scene?this.scene.game.update.remove(this,this.update):this.addActiveQueue(function(){this.scene.game.update.remove(this,this.update)}))};c.prototype.startTimer=function(a,d){this.scene?this.scene.game.addTimer(a,this,d?d:this.interval):this.addActiveQueue(function(){this.scene.game.addTimer(a,this,d?d:this.interval)})};c.prototype.stopTimer=function(a,d){this.scene?this.scene.game.removeTimer(a,this,d?d:this.interval):
this.addActiveQueue(function(){this.scene.game.removeTimer(a,this,d?d:this.interval)})};c.prototype.updated=function(){for(var a=this;a.parent;)a=a.parent;a.isUpdated=!0};c.prototype.isUpdate=function(){return this.isUpdated};c.prototype.reflected=function(){this.isUpdated=!1};c.prototype.tl=function(){this._tl||(this._tl=new e.Timeline(this));return this._tl};c.prototype.destroy=function(){this._tl&&(this._tl.clear(),delete this._tl);this.stop();this.scene&&(this.scene.game.removeTimerAll(this),
this.scene=null);delete this.parent;if(this.entities)for(var a;a=this.entities.pop();)a.destroy();this.pointDown&&(this.pointDown.destroy(),delete this.pointDown);this.pointUp&&(this.pointUp.destroy(),delete this.pointUp);this.pointMove&&(this.pointMove.destroy(),delete this.pointMove)};c.prototype.offset=function(){var a=this.parent?this.parent.offset():{x:this.scroll?this.scroll.x:0,y:this.scroll?this.scroll.y:0};return{x:this.x+a.x,y:this.y+a.y}};c.prototype.rect=function(){var a=this.offset();
return new e.Rectangle(a.x,a.y,a.x+this.width,a.y+this.height)};c.prototype.hitTest=function(a){return this.rect().hitTest(a)};c.prototype.getDistance=function(a){return a.width&&a.height?{x:Math.abs(a.x+a.width/2-(this.x+this.width/2)),y:Math.abs(a.y+a.height/2-(this.y+this.height/2))}:{x:Math.abs(a.x-(this.x+this.width/2)),y:Math.abs(a.y-(this.y+this.height/2))}};c.prototype.getEntityByPoint=function(a,d){if(this.entities)for(var b=this.entities.length-1;0<=b;b--)if(d||this.entities[b].pointCapture){var f=
this.entities[b].getEntityByPoint(a);if(f)return f}return(d||this.pointCapture)&&this.hitTest(a)?this:null};c.prototype.createSprite=function(){var a=new e.BufferedRenderer({width:this.width,height:this.height}),d=this.x,b=this.y;this.y=this.x=0;a.renderUnit(this);this.x=d;this.y=b;return a.createSprite()};c.prototype.update=function(){};c.prototype.interval=function(){};c.prototype.draw=function(){};c.prototype.show=function(){this.opacity=1};c.prototype.hide=function(){this.opacity=0};e.E=c})(jg||
(jg={}));(function(){var e=document.createElement("canvas").getContext("2d"),c;for(c in jg.ENTITY_OPTIONS_DEFAULT_VALUES)void 0==jg.ENTITY_OPTIONS_DEFAULT_VALUES[c]&&(jg.ENTITY_OPTIONS_DEFAULT_VALUES[c]=e[c])})();var __extends=this.__extends||function(e,c){function a(){this.constructor=e}a.prototype=c.prototype;e.prototype=new a};
(function(e){var c=e.E,a=function(a,b,f,g,r){c.call(this);this.y=this.x=0;this.width=a;this.height=b;this.style=f?f:e.ShapeStyle.Stroke;g&&this.setColor(g);this.type=r?r:e.ShapeType.Rect};__extends(a,c);a.PI_200_PER=2*Math.PI;a.prototype.setClip=function(a){(this.clip=a)?this.disableTransform=!0:delete this.disableTransform};a.prototype.setStyle=function(a){this.style=a;this.setColor(this.getColor())};a.prototype.setLineWidth=function(a){this.setDrawOption("lineWidth",a)};a.prototype.getLineWidth=
function(){return this.getDrawOption("lineWidth")};a.prototype.setColor=function(a){this.style==e.ShapeStyle.Stroke?this.setDrawOption("strokeStyle",a):this.setDrawOption("fillStyle",a)};a.prototype.getColor=function(){return this.style==e.ShapeStyle.Stroke?this.getDrawOption("strokeStyle"):this.getDrawOption("filltyle")};a.prototype.synchronize=function(a,b){this.syncObj=a;this.syncFunc=b};a.prototype.draw=function(d){this.syncObj&&this.syncFunc.call(this.syncObj,this);this.clip&&(d.save(),d.translate(this.x,
this.y),this.options&&this.scene.game.renderer.useDrawOption(this,d));d.beginPath();switch(this.type){case e.ShapeType.Rect:d.rect(0,0,this.width,this.height);break;case e.ShapeType.Arc:var b=this.width/2;d.arc(b,b,b,0,a.PI_200_PER,!1)}this.clip?(d.restore(),d.clip()):this.style==e.ShapeStyle.Fill?d.fill():d.stroke()};e.Shape=a})(jg||(jg={}));
(function(e){var c=function(){this.handlers=[]};c.prototype.handleInsert=function(a,d,b){this.handlers.splice(a,0,{owner:d,handler:b})};c.prototype.handle=function(a,d){d?this.handlers.push({owner:a,handler:d}):this.handlers.push({owner:window,handler:a})};c.prototype.destroy=function(){this.handlers=[]};c.prototype.removeAll=function(a){for(var d=[],b;b=this.handlers.pop();)b.owner!=a&&d.push(b);this.handlers=d};c.prototype.removeAllByHandler=function(a){for(var d=[],b;b=this.handlers.pop();)b.handler!=
a&&d.push(b);this.handlers=d};c.prototype.remove=function(a,d){var b=[],f;d||(d=a,a=window);for(;f=this.handlers.pop();)(f.handler!=d||f.owner!=a)&&b.push(f);this.handlers=b};c.prototype.fire=function(a){if(0!=this.handlers.length){for(var d=[],b=0;b<this.handlers.length;b++)d[b]=this.handlers[b];for(b=0;b<d.length;b++)d[b].handler.call(d[b].owner,a)}};c.prototype.fastFire=function(a){for(var d=0;d<this.handlers.length;d++)this.handlers[d].handler.call(this.handlers[d].owner,a)};e.Trigger=c})(jg||
(jg={}));
(function(e){var c=function(){};c.getAudioContext=function(){if(c.context)return c.context;c.context=c._getAudioContext();return c.context};c._getAudioContext=function(){return window.AudioContext?new window.AudioContext:window.webkitAudioContext?new window.webkitAudioContext:null};c.play=function(a,d,b,f){var g=c.getAudioContext(),e=g.createBufferSource();d&&(e.loop=!0);e.buffer=a;f?e.connect(f):(c.soundGain||(a=g.createGain(),a.connect(g.destination),c.soundGain=a),e.connect(c.soundGain));e.start(void 0===
b?0:b);return e};c.hasBgm=function(){return void 0!==c.bgmSource};c.playBgm=function(a,d,b){c.bgmSource&&c.stopBgm();if(!c.bgmGain){var f=c.getAudioContext(),g=f.createGain();g.connect(f.destination);c.bgmGain=g}c.bgmSource=c.play(a,d,b,c.bgmGain);return c.bgmSource};c.stop=function(a,d){a&&a.stop(void 0===d?0:d)};c.stopBgm=function(a){c.stop(c.bgmSource,a);delete c.bgmSource};c.tone=function(a,d){a=void 0!==a?a:200;d=void 0!==d?d:1;for(var b=c.getAudioContext().createBuffer(1,44100*d,44100),f=b.getChannelData(0),
g=0;g<f.length;g++)f[g]=2*Math.sin(a*(g/b.sampleRate)*Math.PI);return b};e.SimpleSound=c})(jg||(jg={}));
(function(e){var c=function(a,d){this.img=a;this.sound=d};c.Default=new c("img/","sound/");c.Plain=new c("","");c.prototype.isAbsolute=function(a){if(0<=[".","/"].indexOf(a.charAt(0))||a.match(/^(http:|https:|data:)/))return a};c.prototype.imageUrl=function(a){return this.isAbsolute(a)?a:this.img+a};c.prototype.soundUrl=function(a){return this.isAbsolute(a)?a:this.sound+a};e.ResourceStructure=c})(jg||(jg={}));
(function(e){var c=function(a){this.resource=a};c.prototype.load=function(){};e.ResourceLoader=c;var a=function(){c.apply(this,arguments)};__extends(a,c);a.prototype.load=function(a,b){var f=new Image;f.src=this.resource.structure.imageUrl(a);var g=this,c=this.completed;f.onerror=function(){c.call(g,b,f,!1)};f.onload=function(){c.call(g,b,f,!0)}};a.prototype.completed=function(a,b,f){f?this.resource.images[a]=b:console.log("error: "+a);this.resource.requestCompleted(a)};e.ImageResourceLoader=a;a=
function(){c.apply(this,arguments)};__extends(a,c);a.prototype.load=function(a,b){var f=this,g=document.createElement("script"),c=document.getElementsByTagName("head");if(0==c.length)throw"can not find head tag";g.src=a+"?"+(new Date).getTime();var e=this.completed;g.onload=function(){e.call(f,b,g,!0)};g.onerror=function(){e.call(f,b,g,!1)};c[0].appendChild(g)};a.prototype.completed=function(a,b,f){f?this.resource.scripts[a]=b:console.log("error: "+a);this.resource.requestCompleted(a)};e.ScriptResourceLoader=
a;a=function(){c.apply(this,arguments)};__extends(a,c);a.prototype.load=function(a,b){var f=this,g=new XMLHttpRequest;g.open("GET",this.resource.structure.soundUrl(a),!0);g.responseType="arraybuffer";var c=this.completed;g.onload=function(){var a=e.SimpleSound.getAudioContext();a?a.decodeAudioData(g.response,function(a){c.call(f,b,a,!0)},function(){c.call(f,b,null,!1)}):c.call(f,b,null,!1)};g.onerror=function(){c.call(f,b,null,!1)};g.send()};a.prototype.completed=function(a,b,f){f?this.resource.sounds[a]=
b:console.log("error: "+a);this.resource.requestCompleted(a)};e.SoundResourceLoader=a})(jg||(jg={}));
(function(e){var c=function(){this.requests=[];this.loaded=new e.Trigger;this.added=new e.Trigger;this.clear();this.loaders={};this.loaders.js=new e.ScriptResourceLoader(this);this.loaders["default"]=new e.ImageResourceLoader(this);this.loaders.mp3=new e.SoundResourceLoader(this);this.loaders.ogg=this.loaders.mp3;this.loaders.wav=this.loaders.mp3;this.loaders.mid=this.loaders.mp3;this.structure=e.ResourceStructure.Default};c.getInstance=function(){c.instance||(c.instance=new c);return c.instance};
c.prototype.clear=function(){this.images={};this.scripts={};this.sounds={}};c.prototype.get=function(a){return this.images[a]};c.prototype.sound=function(a){return this.sounds[a]};c.prototype.requestCompleted=function(a){for(var d=0;d<this.requests.length;d++)if(this.requests[d]==a){this.requests.splice(d,1);break}this.loaded.fire(this.requests.length)};c.prototype.load=function(a,d){d||(d=a);this.requests.push(a);var b=d.split(/\./g),b=0==b.length?"":b[b.length-1],b=b.toLowerCase(),b=this.loaders[b]?
this.loaders[b]:this.loaders["default"];b.load(d,a);this.added.fire({name:a,url:d,loader:b})};c.prototype.loadManual=function(a){this.requests.push(a);this.added.fire({name:a,url:null,loader:null})};c.prototype.completeManual=function(a){this.requestCompleted(a)};e.Resource=c})(jg||(jg={}));
(function(e){var c=function(a){this.game=a;this.layers={};this.root=new e.Layer(this);this.layers.root=this.root;this.layerCount=1;this.mode=[];this.started=new e.Trigger;this.ended=new e.Trigger;this.showed=new e.Trigger;this.hid=new e.Trigger};c.prototype.currentMode=function(){return 0==this.mode.length?null:this.mode[this.mode.length-1]};c.prototype.getLayerArray=function(){var a=[],d;for(d in this.layers)a.push(this.layers[d]);return a};c.prototype.enablePointingEvent=function(){this.root.enablePointingEvent();
this.pointDown||(this.pointDown=new e.Trigger);this.pointMove||(this.pointMove=new e.Trigger);this.pointUp||(this.pointUp=new e.Trigger)};c.prototype.disablePointingEvent=function(){this.root.disablePointingEvent()};c.prototype.changeMode=function(a){var d=this.currentMode();if(d&&this[d+"Hide"])this[d+"Hide"]();this.mode.push(a);if(a){if(this[a+"Start"])this[a+"Start"]();if(this[a+"Show"])this[a+"Show"]()}};c.prototype.endCurrentMode=function(a){if(0==this.mode.length)this.end();else{var d=this.mode.pop();
if(d&&this[d+"End"])this[d+"End"]();if((d=this.currentMode())&&this[d+"Show"])this[d+"Show"]();a&&this.changeMode(a)}};c.prototype.createLayer=function(a,d){for(var b in this.layers)this.layers[b].hasBuffer()||this.layers[b].createBuffer();this.layers[a]=new e.Layer(this);d&&(this.layers[a].width=d.width,this.layers[a].height=d.height);this.layers[a].createBuffer();this.layerCount++;return this.layers[a]};c.prototype.deleteLayer=function(a){if("root"==a)throw"can not delete root layer";this.layers[a].destroy();
delete this.layers[a];this.layerCount--;1==this.layerCount&&this.root.deleteBuffer()};c.prototype.destroy=function(){for(var a in this.layers)this.layers[a].destroy();this.keyDown&&this.keyDown.destroy();this.keyUp&&this.keyUp.destroy();this.pointDown&&this.pointDown.destroy();this.pointUp&&this.pointUp.destroy();this.pointMove&&this.pointMove.destroy()};c.prototype.end=function(){this.game.endScene()};c.prototype.refresh=function(){for(var a in this.layers)this.layers[a].refresh(),this.layers[a].updated()};
c.prototype.scrollTo=function(a,d,b){b||(b="root");this.layers[b].scrollTo(a,d)};c.prototype.scrollBy=function(a,d,b){0==a&&0==d||(b||(b="root"),this.layers[b].scrollBy(a,d))};c.prototype.append=function(a,d){d?this.layers[d].append(a):this.root.append(a)};c.prototype.removeEntity=function(a){for(var d in this.layers)this.layers[d].removeChild(a)};e.Scene=c})(jg||(jg={}));
(function(e){var c=e.E,a=function(a,b,f){c.call(this);this.y=this.x=0;this.width=b?b:a.width;this.height=f?f:a.height;this.srcWidth=this.width;this.srcHeight=this.height;this.srcY=this.srcX=0;this.image=a};__extends(a,c);a.prototype.draw=function(a){a.drawImage(this.image,this.srcX,this.srcY,this.srcWidth,this.srcHeight,0,0,this.width,this.height)};e.Sprite=a})(jg||(jg={}));
(function(e){var c=e.Sprite,a=function(a,b,f,g){c.call(this,a,b,f);this.sep=Math.floor(this.image.width/this.width);a=Math.ceil(a.width*a.height)/(b*f);this.frame=[];for(b=0;b<a;b++)this.frame.push(b);this.fno=0;this.animation=!1;this.wait=void 0===g?200:g;this.loop=!0};__extends(a,c);a.prototype.changeFrame=function(){this.srcX=this.frame[this.fno]%this.sep*this.srcWidth;this.srcY=Math.floor(this.frame[this.fno]/this.sep)*this.srcHeight;this.updated()};a.prototype.startTimer=function(a){if(this.animation)return!0;
a||(this.fno=0);this.animation=!0;c.prototype.startTimer.call(this,this.wait)};a.prototype.stopTimer=function(){this.animation&&(c.prototype.stopTimer.call(this,this.wait),this.animation=!1)};a.prototype.interval=function(){this.fno++;if(this.fno>=this.frame.length)if(this.loop)this.fno=0;else if(this.frameEnded){this.stopTimer();this.frameEnded.fire();return}this.changeFrame()};e.FrameSprite=a})(jg||(jg={}));
(function(e){var c=e.FrameSprite,a=function(a,b,f,g){c.call(this,a,b,f,g);this.moving=!1;this.animeCnt=2;this.charaSeq=0;this.charaCol=1;this.movePixel=64;this.moveTime=300;this.startTimer()};__extends(a,c);a.prototype.moveLeft=function(a){if(this.move(-this.movePixel,0,this.moveTime))return this.angle(e.Angle.Left),!0;a&&2*this.moveInfo.t>=this.moveInfo.f&&(this.nextMove="Left");return!1};a.prototype.moveRight=function(a){if(this.move(this.movePixel,0,this.moveTime))return this.angle(e.Angle.Right),
!0;a&&2*this.moveInfo.t>=this.moveInfo.f&&(this.nextMove="Right");return!1};a.prototype.moveUp=function(a){if(this.move(0,-this.movePixel,this.moveTime))return this.angle(e.Angle.Up),!0;a&&2*this.moveInfo.t>=this.moveInfo.f&&(this.nextMove="Up");return!1};a.prototype.moveDown=function(a){if(this.move(0,this.movePixel,this.moveTime))return this.angle(e.Angle.Down),!0;a&&2*this.moveInfo.t>=this.moveInfo.f&&(this.nextMove="Down");return!1};a.prototype.move=function(a,b,f){if(this.moving)return!1;this.moving=
!0;this.moveInfo={x:this.x,y:this.y,dx:this.x+a,dy:this.y+b,f:f,t:0};this.beginMove&&this.beginMove.fire(this.moveInfo);this.moving&&this.start();return!0};a.prototype.update=function(a){this.moving&&(this.moveInfo.t+=a,this.moveInfo.t<this.moveInfo.f?this.moveTo(this.moveInfo.x+Math.round((this.moveInfo.dx-this.moveInfo.x)/this.moveInfo.f*this.moveInfo.t),this.moveInfo.y+Math.round((this.moveInfo.dy-this.moveInfo.y)/this.moveInfo.f*this.moveInfo.t)):(this.moveTo(this.moveInfo.dx,this.moveInfo.dy),
this.endMove()))};a.prototype.endMove=function(){this.moving=!1;this.stop();var a={};this.nextMove&&(a.nextMove=this.nextMove,delete this.nextMove);this.moved&&this.moved.fire(a);if(a.nextMove)this["move"+a.nextMove]()};a.prototype.angle=function(a){this.currentAngle=a;var b=4*Math.floor(this.charaSeq/this.charaCol);switch(a){case e.Angle.Up:b+=this.angleSeq?this.angleSeq[e.Angle.Up]:3;break;case e.Angle.Down:b+=this.angleSeq?this.angleSeq[e.Angle.Down]:0;break;case e.Angle.Left:b+=this.angleSeq?
this.angleSeq[e.Angle.Left]:1;break;case e.Angle.Right:b+=this.angleSeq?this.angleSeq[e.Angle.Right]:2}a=this.animeCnt*(this.charaSeq%this.charaCol)+this.charaCol*this.animeCnt*b;this.frame=[];if(1==this.animeCnt%2){for(b=0;b<this.animeCnt;b++)this.frame.push(b+a);for(b=this.animeCnt-2;0<b;b--)this.frame.push(b+a)}else for(b=0;b<this.animeCnt;b++)this.frame.push(b+a);this.changeFrame()};e.Character=a})(jg||(jg={}));
(function(e){var c=function(a,d,b){this.width=d;this.height=b;this.image=a;this.wait=200;this.charaCol=1;this.animeCnt=2;this.moveTime=300;this.movePixel=64;this.angle=e.Angle.Down;this.createClass=e.Character};c.prototype.create=function(a,d,b){var f=new this.createClass(this.image,this.width,this.height,this.wait),g=["width","height","image","wait","angle"],c;for(c in this)"function"!=typeof this[c]&&(0<=g.indexOf(c)||(f[c]=this[c]));f.charaSeq=a;f.angle(void 0==b?this.angle:b);d&&f.moveTo(d.x,
d.y);return f};e.CharacterFactory=c})(jg||(jg={}));
(function(e){var c=e.E,a=function(a,b,f,g){c.call(this);this.y=this.x=0;a?this.setText(a):(this.setText(""),this.height=this.width=0);this.setTextBaseline(g?g:"top");this.setFontSize(b?b:14);this.setColor(f?f:"black")};__extends(a,c);a.prototype.setMaxWidth=function(a){this.maxWidth=a;this.updateSize()};a.prototype.updateSize=function(){var a=window.createCanvas(10,10).getContext("2d");a.font=this.getFont();this.width=a.measureText(this.text).width;this.height=this.getFontSize()};a.prototype.addShadow=
function(a){this.setDrawOption("shadowBlur",2);this.setDrawOption("shadowColor",a?a:"black")};a.prototype.removeShadow=function(){this.removeDrawOption("shadowBlur");this.removeDrawOption("shadowColor")};a.prototype.setText=function(a){this.text=a;this.updateSize();this.updated()};a.prototype.setFont=function(a){this.setDrawOption("font",a);this.updateSize()};a.prototype.getFont=function(){return this.getDrawOption("font")};a.prototype.setFontSize=function(a){var b=this.getFont(),f=b.indexOf(" ");
this.setFont(a+"px "+b.substr(f+1))};a.prototype.getFontSize=function(){var a=this.getFont(),b=a.indexOf(" ");try{return parseInt(a.substr(0,b-2))}catch(f){}return this.height};a.prototype.setTextAlign=function(a){this.setDrawOption("textAlign",a)};a.prototype.getTextAlign=function(){return this.getDrawOption("textAlign")};a.prototype.setTextBaseline=function(a){this.setDrawOption("textBaseline",a)};a.prototype.getTextBaseline=function(){return this.getDrawOption("textBaseline")};a.prototype.setColor=
function(a){this.setDrawOption("fillStyle",a)};a.prototype.getColor=function(){return this.getDrawOption("fillStyle")};a.prototype.synchronize=function(a,b,f){this.syncObj=a;this.syncProp=b;this.syncRound=f};a.prototype.draw=function(a){if(this.syncObj){var b;b="function"==typeof this.syncObj[this.syncProp]?this.syncObj[this.syncProp](this):this.syncObj[this.syncProp];this.text=this.syncRound?Math.round(b):b}this.maxWidth?a.fillText(this.text,0,0,this.maxWidth):a.fillText(this.text,0,0)};e.Label=
a})(jg||(jg={}));
(function(e){var c;c=function(a){this.height=this.width=0;this.offsetY=a};e.TextLineInfo=c;var a=function(){};a.prototype.init=function(a,d,b){this.mode=0;this.owner=a;this.context=d;this.pos=b};a.prototype.next=function(a){if(this.mode){if(" "==a){if(this.mode=0,"page"==this.buf)return-1}else this.buf+=a;return 1}return"#"==a?(this.mode=1,this.buf="",1):0};e.MultilineScriptAnalyzer=a;var d=e.E,b=function(b,c){d.call(this);this.scriptAnalyzer=new a;this.width=b.width;this.height=b.height;c?this.moveTo(c.x,
c.y):this.moveTo(0,0);this.defaultStyle="#000";this.defaultFont="18px sans-serif";this.defaultBlur=0.6;this.defaultShadowColor="#000";this.defaultShadowOffsetY=this.defaultShadowOffsetX=0.3;this.clip=new e.Line({x:0,y:0});this.clip.addLine(this.width,0);this.clip.addLine(this.width,this.height);this.clip.addLine(0,this.height);this.clip.addLine(0,this.height);this.clip.addLine(0,this.height);this.clip.closePath=!0;this.clip.setClip(!0);this.entities=[];this.entities.push(this.clip);this.animeSpeed=
400;this.animated=new e.Trigger};__extends(b,d);b.LINE_HEIGHT_NORMAL=1.2;b.BROWSER_BASELINE_MARGIN=0;b.prototype.setText=function(a,d){return this.setScript(a,d)};b.prototype.setScript=function(a,d){this.script=a.replace(/\r\n?/g,"\n");this.updated();return this.createBuffer(d)};b.prototype.getLineHeight=function(a){a=a.font;var d=a.indexOf("px"),c=a.lastIndexOf(" ",d);0>c&&(c=0);if(0>d)return 16;a=parseInt(a.substring(c,d));return Math.round(a*b.LINE_HEIGHT_NORMAL)};b.prototype.createBuffer=function(a){var d=
this;this.buffer||(this.buffer=window.createCanvas(this.width,this.height));void 0===a&&(a=0);var r=this.script,h=r.length,m={x:0,y:0},q=this.buffer.getContext("2d"),w,j=b.BROWSER_BASELINE_MARGIN;this.lines=[];this.bufferBg?q.putImageData(this.bufferBg,0,0):q.clearRect(0,0,this.width,this.height);q.fillStyle=this.defaultStyle;q.font=this.defaultFont;q.textBaseline="top";this.disableShadow||(q.shadowBlur=this.defaultBlur,q.shadowColor=this.defaultShadowColor,q.shadowOffsetX=this.defaultShadowOffsetX,
q.shadowOffsetY=this.defaultShadowOffsetY);var n=this.getLineHeight(q),l=new c(0);l.height=n;this.lines.push(l);var s=function(){m.x=0;m.y+=l.height;if(m.y+l.height>d.height)return!1;l=new c(m.y);l.height=n;d.lines.push(l);return!0};for(this.scriptAnalyzer.init(this,q,m);a<h;){w=r.substr(a,1);var k=this.scriptAnalyzer.next(w);if(k){n=l.height;if(0>k){a-=k;break}a+=k}else if("\n"==w){if(a++,!s())break}else{k=q.measureText(w);if(m.x+k.width>this.width&&!s())break;q.fillText(w,m.x,m.y+j);m.x+=k.width;
l.width+=k.width;a++}}this.sprite=new e.Sprite(this.buffer);this.sprite.moveTo(0,0);1==this.entities.length?this.entities.push(this.sprite):this.entities[1]=this.sprite;return a==h?-1:a};b.prototype.refresh=function(){delete this.buffer;this.createBuffer()};b.prototype.startAnimation=function(a){this.start();this.animeLine=0;this.animePos={x:0,y:this.lines[this.animeLine].height};void 0!==a&&(this.animeSpeed=a);this.hideAll();this.clip.p[4].y=this.animePos.y;this.clip.p[5].y=this.animePos.y};b.prototype.update=
function(a){this.animePos.x+=this.animeSpeed/1E3*a;this.animePos.x>=this.lines[this.animeLine].width&&(this.animePos.x=0,this.animePos.y+=this.lines[this.animeLine].height,this.animeLine++,this.animeLine<this.lines.length&&(this.clip.p[2].y=this.lines[this.animeLine].offsetY,this.clip.p[3].y=this.clip.p[2].y,this.clip.p[4].y=this.animePos.y,this.clip.p[5].y=this.animePos.y));this.animeLine>=this.lines.length?this.showAll():(this.clip.p[3].x=this.animePos.x,this.clip.p[4].x=this.clip.p[3].x);this.updated()};
b.prototype.hideAll=function(){this.clip.p[0]={x:0,y:0};this.clip.p[1]={x:this.width,y:0};this.clip.p[2]={x:this.width,y:0};this.clip.p[3]={x:0,y:0};this.clip.p[4]={x:0,y:0};this.clip.p[5]={x:0,y:0}};b.prototype.showAll=function(){this.clip.p[0]={x:0,y:0};this.clip.p[1]={x:this.width,y:0};this.clip.p[2]={x:this.width,y:this.height};this.clip.p[3]={x:0,y:this.height};this.clip.p[4]={x:0,y:this.height};this.clip.p[5]={x:0,y:this.height};this.stop();this.animated.fire()};e.MultilineText=b})(jg||(jg=
{}));
(function(e){var c=function(a,d){this.image=d;this.tile=a;this.sep=Math.floor(this.image.width/this.tile.tileWidth)};c.prototype.count=function(){return Math.round(this.image.width*this.image.height/(this.tile.tileWidth*this.tile.tileHeight))};c.prototype.draw=function(a,d,b,c){var e=this.tile.tileWidth,q=this.tile.tileHeight;a.drawImage(this.image,c%this.sep*e,Math.floor(c/this.sep)*q,e,q,d*e,b*q,e,q)};e.ChipSet=c;var a=function(){c.apply(this,arguments)};__extends(a,c);a.prototype.map=function(a,d){return 0>
a||0>d||a>=this.tile.size.width||d>=this.tile.size.height?-1:this.tile.data[a][d]};a.prototype.draw=function(a,d,b){for(var c=this.tile.tileWidth,e=this.tile.tileHeight,q=Math.floor(this.tile.tileWidth/2),w=Math.floor(this.tile.tileHeight/2),j=0;4>j;j++)for(var n=0;4>n;n++){var l=d+(Math.floor((j+1)/2)-1),s=b+(Math.floor((n+1)/2)-1),k=this.map(l,s);if(-1!=k){var t=l+(0==j%2?1:-1),u=s+(0==n%2?1:-1),s=this.map(t,s),l=this.map(l,u),u=this.map(t,u),t=0;l==k&&t++;s==k&&(t+=2);3==t&&u==k&&t++;a.drawImage(this.image,
t%this.sep*c+q*(0==j%2?1:0),Math.floor(t/this.sep)*e+w*(0==n%2?1:0),q,w,d*c+q*(j-1),b*e+w*(n-1),q,w)}}};e.AutoTileChipSet=a;var d=e.E,b=function(a,b,c){d.call(this);this.tileWidth=b;this.tileHeight=c;this.chips=[];this.chipMap=[];this.chipCount=0;a&&this.addChipSet(a);this.y=this.x=0;this.disableTransform=!0};__extends(b,d);b.prototype.addChipSet=function(d,b){var e;b&&b.autoTile&&(e=new a(this,d));e||(e=new c(this,d));e.chipOffset=this.chipCount;this.chips.push(e);for(var h=e.count(),h=this.chipCount+
h,m=this.chipCount;m<h;m++)this.chipMap[m]=e;this.chipCount=h};b.prototype.generate=function(a,d,b){this.data=a;d||(d=this.data.length);b||(b=this.data[0].length);this.size={width:d,height:b};this.width=this.tileWidth*d;this.height=this.tileHeight*b;this.refresh()};b.prototype.refresh=function(){this.canvas=window.createCanvas(this.width,this.height);for(var a=this.canvas.getContext("2d"),d=0;d<this.size.width;d++)for(var b=0;b<this.size.height;b++)if(!(0>this.data[d][b])){var c=this.chipMap[this.data[d][b]];
c.draw(a,d,b,this.data[d][b]-c.chipOffset)}};b.prototype.draw=function(a){var d=this.parent?this.parent:this,b=d.scroll?d.scroll:{x:0,y:0},c=-b.x,e=-b.y,q=d.width,w=d.height,j=-b.x,b=-b.y,n=d.width,d=d.height;if(0>c){q+=c;if(0>=q)return;j-=c;n+=c;c=0}else if(c+q>this.width){var l=c+q-this.width,q=q-l;if(0>=q)return;n-=l}if(0>e){w+=e;if(0>=w)return;b-=e;d+=e;e=0}else if(e+w>this.height){l=e+w-this.height;w-=l;if(0>=w)return;d-=l}a.drawImage(this.canvas,c,e,q,w,j,b,n,d)};e.Tile=b})(jg||(jg={}));
(function(e){var c=e.E,a=function(a){c.call(this);this.entities=[];this.y=this.x=0;this.scene=a;this.width=this.scene.game.width;this.height=this.scene.game.height;this.isUpdated=!0};__extends(a,c);a.prototype.hasBuffer=function(){return this.canvas?!0:!1};a.prototype.createBuffer=function(){this.refresh(!0)};a.prototype.refresh=function(a){if(a||this.hasBuffer())this.canvas=window.createCanvas(this.width,this.height),this.context=this.canvas.getContext("2d"),this.updated();if(this.entities)for(a=
0;a<this.entities.length;a++)this.entities[a].refresh&&this.entities[a].refresh()};a.prototype.deleteBuffer=function(){delete this.context;delete this.canvas};a.prototype.destroy=function(){c.prototype.destroy.call(this);this.hasBuffer()&&this.deleteBuffer()};e.Layer=a})(jg||(jg={}));
(function(e){var c=e.Scene,a=function(a,b){c.call(this,a);this.game=a;this.resource=b;this.resource.loaded.handle(this,this.complete);this.resource.added.handle(this,this.added);this.requestCount=this.resource.requests.length;this.finished=new e.Trigger;this.init()};__extends(a,c);a.prototype.init=function(){this.shape=new e.Shape(this.game.width,32);this.shape.moveTo(0,this.game.height/2-16);this.shapeP=new e.Shape(1,32,e.ShapeStyle.Fill);this.shapeP.moveTo(0,this.game.height/2-16);this.append(this.shape);
this.append(this.shapeP)};a.prototype.animate=function(a){this.shapeP.width=this.game.width*a;this.shapeP.updated()};a.prototype.complete=function(a){a=(this.requestCount-a)/this.requestCount;this.animate(a);1==a&&(this.resource.loaded.remove(this,this.complete),this.resource.added.remove(this,this.added),this.end(),this.finished.fire())};a.prototype.added=function(){this.requestCount++};e.LoadingScene=a})(jg||(jg={}));
(function(e){var c;c=function(a,b,c){this.type=a;this.action=b;this.param=c};e.InputEvent=c;var a=function(a,b,f){c.call(this,e.InputEventType.Keyboard,a,f);this.key=b};__extends(a,c);e.InputKeyboardEvent=a;a=function(a,b,f){c.call(this,e.InputEventType.Point,a,b);this.point=f};__extends(a,c);a.prototype.set=function(a){var b=a.offset();this.entity=a;this.x=this.point.x-b.x;this.y=this.point.y-b.y};e.InputPointEvent=a})(jg||(jg={}));
(function(e){var c=function(){var a=this;this.radian=Math.PI/180;this.drawOptionFunctions={transform:function(a,b,c){a.transform(c.m11,c.m12,c.m21,c.m22,c.dx,c.dy)},translate:function(a,b,c){a.translate(c.x,c.y)},scale:function(d,b,c){d.transform.apply(d,a.getMatrix(b.width,b.height,c.x,c.y,0))},rotate:function(d,b,c){d.transform.apply(d,a.getMatrix(b.width,b.height,1,1,c))}}};c.prototype.getMatrix=function(a,d,b,c,g){g*=this.radian;var e=Math.cos(g),h=Math.sin(g);g=e*b;b*=h;h*=c;c*=e;a/=2;d/=2;return[g,
b,-h,c,-g*a+h*d+a,-b*a-c*d+d]};c.prototype.renderParent=function(a,d){a.orderDraw&&a.orderDraw();d.save();1!=a.opacity&&(d.globalAlpha=a.opacity);if(!a.options||!this.useDrawOption(a,d)){a.scroll&&d.translate(a.scroll.x,a.scroll.y);for(var b=0;b<a.entities.length;b++)this.renderEntity(a.entities[b],d)}d.restore()};c.prototype.renderEntity=function(a,d){if(a.opacity)if(a.disableTransform)a.draw(d);else{d.save();d.translate(a.x,a.y);1!=a.opacity&&(d.globalAlpha*=a.opacity);if(!a.options||!this.useDrawOption(a,
d))if(a.filter)this.filterDraw(a,d);else if(a.draw(d),a.entities){a.scroll&&d.translate(a.scroll.x,a.scroll.y);for(var b=0;b<a.entities.length;b++)this.renderEntity(a.entities[b],d)}d.restore()}};c.prototype.renderPure=function(a,d){a.draw(d);if(a.entities)for(var b=0;b<a.entities.length;b++)this.renderEntity(a.entities[b],d)};c.prototype.filterDraw=function(a,d){var b=new e.BufferedRenderer(a);b.filter=a.filter;b.renderPure(a,b.c);b.applyFilter(b.c,a);b.draw(d)};c.prototype.useDrawOption=function(a,
d){for(var b in a.options)this.drawOptionFunctions[b]?this.drawOptionFunctions[b].call(this,d,a,a.options[b]):d[b]=a.options[b]};e.Renderer=c})(jg||(jg={}));
(function(e){var c=e.Renderer,a=function(a,b,f,g){c.call(this);this.game=a;this.container=b?b:document.getElementById("jgame");if(!this.container){a=document.createElement("div");a.id="jgame";b=document.getElementsByTagName("body");if(0==b.length)throw"can not initialize game engine";b[0].appendChild(a);this.container=a}this.handler=document.createElement("div");this.handler.style.display="inline-block";this.container.appendChild(this.handler);this.changeTransferMode(f?f:e.RenderTransferMode.Transfer);
if(!g){this.bg=this.fc.getImageData(0,0,this.game.width,this.game.height);for(f=0;f<this.bg.data.length;f++)this.bg.data[f]=255}};__extends(a,c);a.prototype.changeFrontCanvasSize=function(a,b){this.frontCanvasSize=a;this.frontCanvasOffset=b;this.refresh()};a.prototype.changeTransferMode=function(a){this.transferMode=a;this.transferMode==e.RenderTransferMode.Flip&&(this.handler.style.position="relative",this.handler.style.width=this.game.width+"px",this.handler.style.height=this.game.height+"px");
this.refresh()};a.prototype.changeScene=function(a){this.scene=a};a.prototype.flip=function(){this.bc=this.fc=this.bc;this.flipNo=this.flipNo?0:1;this.buffer[this.flipNo].style.zIndex="1";this.buffer[this.flipNo?0:1].style.zIndex="0"};a.prototype.render=function(){var a=!1;if(1==this.scene.layerCount){var b=this.scene.root;b.isUpdate()&&(a=!0,this.disableClear||this.bc.putImageData(this.bg,0,0),this.renderParent(b,this.bc),b.reflected())}else{for(var c in this.scene.layers)if(this.scene.layers[c].isUpdate()){a=
!0;break}if(a)for(c in this.disableClear||this.bc.putImageData(this.bg,0,0),this.scene.layers)b=this.scene.layers[c],b.isUpdate()&&(b.context.clearRect(0,0,b.width,b.height),this.renderParent(b,b.context)),this.bc.drawImage(b.canvas,b.x,b.y),b.reflected()}a&&(this.filter?(a=this.bc.getImageData(0,0,this.game.width,this.game.height),this.filter.filter(a),this.fc.putImageData(a,0,0)):this.bc!=this.fc?this.fc.drawImage(this.buffer[1],0,0):this.transferMode==e.RenderTransferMode.Flip&&this.flip())};a.prototype.refresh=
function(){delete this.buffer;this.buffer=[];if(this.transferMode==e.RenderTransferMode.Flip){this.handler.innerHTML="";for(var a=0;2>a;a++)this.buffer[a]=window.createCanvas(this.game.width,this.game.height),this.buffer[a].style.position="absolute",this.buffer[a].style.zIndex=a.toString(),this.handler.appendChild(this.buffer[a]);this.fc=this.buffer[1].getContext("2d");this.bc=this.buffer[0].getContext("2d");this.flipNo=1;this.frontCanvasSize&&e.JGUtil.scaleCanvas(this.buffer[1],this.frontCanvasSize)}else if(this.transferMode==
e.RenderTransferMode.Transfer){this.handler.innerHTML="";for(a=0;2>a;a++)this.buffer[a]=window.createCanvas(this.game.width,this.game.height);this.handler.appendChild(this.buffer[0]);this.fc=this.buffer[0].getContext("2d");this.bc=this.buffer[1].getContext("2d")}else this.handler.innerHTML="",this.buffer[0]=window.createCanvas(this.game.width,this.game.height),this.handler.appendChild(this.buffer[0]),this.bc=this.fc=this.buffer[0].getContext("2d");this.frontCanvasSize&&(e.JGUtil.scaleCanvas(this.buffer[0],
this.frontCanvasSize),this.frontCanvasOffset&&(this.handler.style.position="relative",this.handler.style.left=this.frontCanvasOffset.x+"px",this.handler.style.top=this.frontCanvasOffset.y+"px"));a=this.handler.getBoundingClientRect();this._pageX=Math.round(window.scrollX||window.pageXOffset+a.left);this._pageY=Math.round(window.scrollY||window.pageYOffset+a.top)};e.GameRenderer=a})(jg||(jg={}));
(function(e){var c=e.Renderer,a=function(a){c.call(this);this.size=a;this.refresh()};__extends(a,c);a.prototype.clear=function(){this.c.clearRect(0,0,this.size.width,this.size.height)};a.prototype.createImage=function(a,b,c){a||(a={x:0,y:0,width:this.size.width,height:this.size.height});b||(b={x:0,y:0,width:a.width,height:a.height});c||(c=a);c=window.createCanvas(c.width,c.height);var g=c.getContext("2d");g.drawImage(this.buffer,a.x,a.y,a.width,a.height,b.x,b.y,b.width,b.height);this.filter&&this.applyFilter(g,
b);return c};a.prototype.createSprite=function(a,b,c){a||(a={x:0,y:0,width:this.size.width,height:this.size.height});b||(b={x:0,y:0,width:a.width,height:a.height});return new e.Sprite(this.createImage(a,b,c),a.width,a.height)};a.prototype.applyFilter=function(a,b){var c=a.getImageData(0,0,b.width,b.height);this.filter.filter(c);a.putImageData(c,0,0)};a.prototype.renderUnit=function(a){this.renderEntity(a,this.c)};a.prototype.renderLayer=function(a){this.renderParent(a,this.c)};a.prototype.renderScene=
function(a){this.clear();for(var b in a.layers){this.c.save();var c=a.layers[b];(c.x||c.y)&&this.c.translate(c.x,c.y);this.renderLayer(c);this.c.restore()}};a.prototype.refresh=function(){delete this.buffer;this.buffer=window.createCanvas(this.size.width,this.size.height);this.c=this.buffer.getContext("2d")};a.prototype.draw=function(a){a.drawImage(this.buffer,0,0,this.size.width,this.size.height,0,0,this.size.width,this.size.height)};e.BufferedRenderer=a})(jg||(jg={}));
(function(e){var c=function(a){this.wait=a;this.tick=0;this.trigger=new e.Trigger};c.prototype.tryFire=function(a){this.tick+=a;this.wait<=this.tick&&this.fire(a)};c.prototype.fire=function(a){this.tick=0;this.trigger.fastFire(a)};e.GameTimer=c})(jg||(jg={}));
(function(e){var c=function(a,d){for(var b=0;b<arguments.length-2;b++);this._exit=!1;this.width=a;this.height=d;this.targetFps=0;this.loadingSceneClass=e.LoadingScene;this.keymap={13:e.Keytype.Enter,27:e.Keytype.Esc,37:e.Keytype.Left,38:e.Keytype.Up,39:e.Keytype.Right,40:e.Keytype.Down};this.loaded=new e.Trigger;this.update=new e.Trigger;this.pointDown=new e.Trigger;this.pointUp=new e.Trigger;this.pointMove=new e.Trigger;this.keyDown=new e.Trigger;this.keyUp=new e.Trigger;this.timers=[];this.scene=
new e.Scene(this);this.scenes=[];this.scenes.push(this.scene);this.resource=e.Resource.getInstance();for(var c,g,b=2;b<arguments.length;b++)arguments[b]instanceof HTMLElement?c=arguments[b]:"string"==typeof arguments[b]?(this.renderer=new window[arguments[b]](this,c,g),this.renderer.changeScene(this.scene)):g=arguments[b];this.renderer||(this.renderer=new e.GameRenderer(this,c,g),this.renderer.changeScene(this.scene));this.eventQueue=[];this.inputEventMap={};this.inputEventMap[e.InputEventType.Keyboard]=
{};this.inputEventMap[e.InputEventType.Keyboard][e.InputEventAction.Down]="keyDown";this.inputEventMap[e.InputEventType.Keyboard][e.InputEventAction.Up]="keyUp";this.inputEventMap[e.InputEventType.Point]={};this.inputEventMap[e.InputEventType.Point][e.InputEventAction.Down]="pointDown";this.inputEventMap[e.InputEventType.Point][e.InputEventAction.Move]="pointMove";this.inputEventMap[e.InputEventType.Point][e.InputEventAction.Up]="pointUp";this.keyboardHandler();this.pointHandler();document.getElementById("fps_show")&&
(this.fps=document.getElementById("fps_show"));this.setSeed();this.main()};c.prototype.setSeed=function(a){this.seed=void 0===a?(new Date).getTime():a;this.mt=new e.MT(a)};c.prototype.random=function(a,d){return this.mt.nextInt(a,d-a+1)};c.prototype.getWindowSize=function(){return{width:document.documentElement.clientWidth,height:document.documentElement.clientHeight}};c.prototype.fitToWindow=function(a){var d=this.renderer.container.parentElement;d.style.margin="0";d.style.padding="0";d.style.overflow=
"hidden";this.renderer.container.style.margin="0";this.renderer.container.style.padding="0";d=this.getWindowSize();this.renderer.container.style.width=d.width+"px";this.renderer.container.style.height=d.height+"px";this.scale=Math.min(d.width/this.width,d.height/this.height);var b={width:Math.floor(this.width*this.scale),height:Math.floor(this.height*this.scale)};this.renderer.changeFrontCanvasSize(b,a?void 0:{x:Math.floor((d.width-b.width)/2),y:Math.floor((d.height-b.height)/2)})};c.prototype.setBgColor=
function(a,d,b,c){for(var g=0;g<this.renderer.bg.data.length;g+=4)this.renderer.bg.data[g]=a,this.renderer.bg.data[g+1]=d,this.renderer.bg.data[g+2]=b,this.renderer.bg.data[g+3]=c};c.prototype.refresh=function(){this.renderer.refresh();for(var a=0;a<this.scenes.length;a++)this.scenes[a].refresh()};c.prototype.isTouchEnable=function(){var a=document.createElement("div");a.setAttribute("ontouchstart","return");return"function"===typeof a.ontouchstart};c.prototype.getOffsetByEvent=function(a){a.offset=
{x:a.pageX-this.renderer._pageX,y:a.pageY-this.renderer._pageY};return{x:this.scale?a.offset.x/this.scale:a.offset.x,y:this.scale?a.offset.y/this.scale:a.offset.y}};c.prototype.onmousedown=function(a){this.isPointDown=!0;this.eventQueue.push(new e.InputPointEvent(e.InputEventAction.Down,a,this.getOffsetByEvent(a)));a.preventDefault()};c.prototype.ontouchstart=function(a){var d=a.changedTouches;this.isPointDown=!0;for(var b=0,c=d.length;b<c;b++)this.eventQueue.push(new e.InputPointEvent(e.InputEventAction.Down,
d[b],this.getOffsetByEvent(d[b])));a.preventDefault()};c.prototype.onmousemove=function(a){this.isPointDown&&(this.eventQueue.push(new e.InputPointEvent(e.InputEventAction.Move,a,this.getOffsetByEvent(a))),a.preventDefault())};c.prototype.ontouchmove=function(a){if(this.isPointDown){for(var d=a.changedTouches,b=0,c=d.length;b<c;b++)this.eventQueue.push(new e.InputPointEvent(e.InputEventAction.Move,d[b],this.getOffsetByEvent(d[b])));a.preventDefault()}};c.prototype.onmouseup=function(a){this.isPointDown&&
(this.eventQueue.push(new e.InputPointEvent(e.InputEventAction.Up,a,this.getOffsetByEvent(a))),this.isPointDown=!1,a.preventDefault())};c.prototype.ontouchend=function(a){if(this.isPointDown){for(var d=a.changedTouches,b=0,c=d.length;b<c;b++)this.eventQueue.push(new e.InputPointEvent(e.InputEventAction.Up,d[b],this.getOffsetByEvent(d[b])));this.isPointDown=!1;a.preventDefault()}};c.prototype.pointHandler=function(){this.dragParam=null;try{this.isTouchEnable()?(this.renderer.handler.addEventListener("touchstart",
e.JGUtil.proxy(this.ontouchstart,this),!1),this.renderer.handler.addEventListener("touchmove",e.JGUtil.proxy(this.ontouchmove,this),!1),this.renderer.handler.addEventListener("touchend",e.JGUtil.proxy(this.ontouchend,this),!1)):(this.renderer.handler.addEventListener("mousedown",e.JGUtil.proxy(this.onmousedown,this),!1),this.renderer.handler.addEventListener("mousemove",e.JGUtil.proxy(this.onmousemove,this),!1),this.renderer.handler.addEventListener("mouseup",e.JGUtil.proxy(this.onmouseup,this),!1))}catch(a){}};
c.prototype.onkeydown=function(a){var d=new e.InputKeyboardEvent(e.InputEventAction.Down,this.keymap[a.keyCode],a);this.eventQueue.push(d);void 0!=this.keymap[a.keyCode]&&a.preventDefault()};c.prototype.onkeyup=function(a){var d=new e.InputKeyboardEvent(e.InputEventAction.Up,this.keymap[a.keyCode],a);this.eventQueue.push(d);void 0!=this.keymap[a.keyCode]&&a.preventDefault()};c.prototype.keyboardHandler=function(){try{document.addEventListener("keydown",e.JGUtil.proxy(this.onkeydown,this),!1),document.addEventListener("keyup",
e.JGUtil.proxy(this.onkeyup,this),!1)}catch(a){}};c.prototype.addTimer=function(a,d,b){for(var c=null,g=0;g<this.timers.length;g++)if(this.timers[g].wait==a){c=this.timers[g];break}null==c&&(c=new e.GameTimer(a),this.timers.push(c));c.trigger.handle(d,b)};c.prototype.removeTimer=function(a,d,b){for(var c=null,g=0;g<this.timers.length;g++)if(this.timers[g].wait==a){c=this.timers[g];break}if(null==c)throw"error removeTimer: dont have "+a+" timer";c.trigger.remove(d,b)};c.prototype.removeTimerAll=function(a){for(var d=
0;d<this.timers.length;d++)this.timers[d].trigger.removeAll(a)};c.prototype.exit=function(){this._exit=!0};c.prototype.changeScene=function(a,d,b){var c=this;d?e.Effect.sceneEffect(this,this.scene,a,d,function(){c.endScene();c.changeScene(a)},b):(this.scenes.push(a),a.game=this,this.scene.hid.fire(),this.scene=a,this.renderer.changeScene(this.scene),this.scene.started.fire())};c.prototype.endScene=function(a){var d=this;1==this.scenes.length?this.exit():a?e.Effect.sceneEffect(this,this.scene,this.scenes[this.scenes.length-
2],a,function(){d.endScene()},!0):(this.scene.destroy(),this.scenes.pop(),this.scene.ended.fire(),this.scene=this.scenes[this.scenes.length-1],this.renderer.changeScene(this.scene),this.scene.showed.fire())};c.prototype.r=function(a){return this.resource.get(a)};c.prototype.s=function(a){return this.resource.sound(a)};c.prototype.preload=function(a){if(a instanceof Array)for(var d=0;d<a.length;d++)this.resource.load(a[d],a[d]);else if("string"==typeof a)for(d=0;d<arguments.length;d++)this.resource.load(arguments[d],
arguments[d]);else for(d in a)this.resource.load(d,a[d]);this.loadingSceneClass&&!this.loadingScene&&this.setLoadingScene(this.loadingSceneClass)};c.prototype.preloadOther=function(a){this.resource.loadManual(a)};c.prototype.preloadCompleteOther=function(a){this.resource.completeManual(a)};c.prototype.setLoadingScene=function(a){this.loadingScene||(this.loadingScene=a instanceof e.LoadingScene?a:new a(this,this.resource),this.loadingScene.finished.handle(this,this.preloadComplete),this.changeScene(this.loadingScene))};
c.prototype.preloadComplete=function(){this.loadingScene&&delete this.loadingScene;this.loaded.fire()};c.prototype.end=function(){this.renderer.render();this._exit=!0};c.prototype.setPointingEntity=function(a){for(var d=this.scene.getLayerArray(),b,c=a.point;b=d.pop();)if(b.pointCapture){(d=b.getEntityByPoint(c))||(d=b);a.set(d);this.dragParam=a;break}};c.prototype.raiseInputEvent=function(){for(var a;a=this.eventQueue.shift();){var d=this.inputEventMap[a.type][a.action];if(a.type!=e.InputEventType.Keyboard){if(a.action==
e.InputEventAction.Down)this.setPointingEntity(a);else if(this.dragParam)a.set(this.dragParam.entity);else break;a.entity&&a.entity[d]&&a.entity[d].fire(a)}this.scene[d]&&this.scene[d].fire(a);this[d].fire(a)}};c.prototype.main=function(){var a=this,d=[],b=function(c){void 0===c&&(c=Date.now?Date.now():(new Date).getTime());if(a.tick>c+1E4||a.tick+1E4<c)a.tick=c-1,a.renderTick=c-a.targetFps,a.refresh();var g=c-a.tick;a.tick<c&&(a.raiseInputEvent(),a.update.fire(g),a.tick=c);for(var e=0;e<a.timers.length;e++)a.timers[e].tryFire(g);
if(0==a.targetFps||a.renderTick<=c)a.render&&a.render.fire(),a.renderer.render(),a.targetFps&&(a.renderTick=c+a.targetFps),a.fps&&(19==d.length?(a.fps.innerHTML=Math.round(2E4/(c-d[0])).toString(),d=[]):d.push(c));a._exit||window.requestAnimationFrame(b)};this.renderTick=this.tick=0;window.requestAnimationFrame(b)};c.prototype.fullscreen=function(){var a=this.renderer.container;if(a.requestFullScreen)a.requestFullScreen();else if(a.webkitRequestFullScreen)a.webkitRequestFullScreen();else if(a.mozRequestFullScreen)a.mozRequestFullScreen();
else return!1;return!0};c.prototype.exitFullscreen=function(){var a=this.renderer.container;if(a.exitFullscreen)a.exitFullscreen();else if(a.webkitCancelFullScreen)a.webkitCancelFullScreen();else if(a.mozCancelFullScreen)a.mozCancelFullScreen();else return!1;return!0};e.Game=c})(jg||(jg={}));
(function(e){var c=e.ImageFilter||(e.ImageFilter={}),a=function(){this.filters=[]};a.prototype.get=function(a){return this.filters[a]};a.prototype.add=function(a){this.filters.push(a);return this};a.prototype.set=function(a){this.filters=[a];return this};a.prototype.insert=function(a,d){for(var b=1;b<arguments.length;b++)this.filters.splice(a,0,arguments[b]);return this};a.prototype.remove=function(a){for(var d=0;d<this.filters.length;d++)if(this.filters[d]==a){this.filters.splice(d,1);break}};a.prototype.clear=
function(){this.filters=[];return this};a.prototype.count=function(){return this.filters.length};a.prototype.has=function(){return 0<this.filters.length};a.prototype.createSprite=function(a){var d=new e.BufferedRenderer({width:a.width,height:a.height});d.filter=this;var b=a.x,c=a.y;a.x=0;a.y=0;d.renderUnit(a);a.x=b;a.y=c;return d.createSprite()};a.prototype.createImage=function(a){var d=new e.BufferedRenderer({width:a.image.width,height:a.image.height});a=new e.Sprite(a.image);a.x=0;a.y=0;d.filter=
this;d.renderUnit(a);return d.createImage()};a.prototype.filter=function(a){for(var d=this.filters.length,b=0;b<d;b++)this.filters[b].filter(a)};c.FilterChain=a;var d=function(a){this.opt={};this.game=a};d.prototype.filter=function(){};d.prototype.getOption=function(a,d){return void 0===this.opt[a]?d:this.opt[a]};d.prototype.findColorDifference=function(a,d,b){return a*d+(1-a)*b};d.prototype.createColor=function(a){a=a.replace(/^#/,"");3==a.length&&(a=a.replace(/(.)/g,"$1$1"));return a};d.prototype.applyMatrix=
function(a,d,b){for(var c=a.data,e=a.width,f=a.height,j=c.length,n=Array(c.length),l=0;l<j;l++)n[l]=c[l];for(var j=Math.sqrt(d.length),s=Math.floor(j/2),l=1;l<e-1;l++)for(var k=1;k<f-1;k++){for(var t=0,u=0,x=0,v=0;v<j;v++)for(var y=0;y<j;y++)var z=l+y-s+(k+v-s)*e<<2,t=t+n[z]*d[y+v*j],u=u+n[z+1]*d[y+v*j],x=x+n[z+2]*d[y+v*j];v=l+k*e<<2;y=c[v+1];z=c[v+2];c[v]=this.findColorDifference(b,t,c[v]);c[v+1]=this.findColorDifference(b,u,y);c[v+2]=this.findColorDifference(b,x,z)}return a};d.prototype.checkRGBBoundary=
function(a){return 0>a?0:255<a?255:a};c.Filter=d;var b=function(a,b,c,e){d.call(this,a);this.opt.amount=c;this.opt.image=b;this.opt.repeat=e};__extends(b,d);b.prototype.getImageData=function(a,d){var b;d?b=d.getContext("2d"):(d=window.createCanvas(a.width,a.height),b=d.getContext("2d"),b.drawImage(a,0,0));return b.getImageData(0,0,a.width,a.height)};b.prototype.createRuleImage=function(){var a=this.opt.image;a instanceof ImageData?this.ruleImage=a:a instanceof HTMLCanvasElement?this.ruleImage=this.getImageData(a,
a):a instanceof HTMLImageElement||a instanceof HTMLVideoElement?this.ruleImage=this.getImageData(a):(a=a.createSprite(),this.ruleImage=this.getImageData(a.image))};b.prototype.createMask=function(){var a,d=this.getImageData(this.opt.mask1).data,b=this.getImageData(this.opt.mask2).data;a={};for(var c=0,e=d.length;c<e;c+=4)a[c]=d[c]==b[c]&&d[c+1]==b[c+1]&&d[c+2]==b[c+2]&&d[c+3]==b[c+3]?1:0;return this.mask=a};b.prototype.filter=function(a){this.ruleImage||this.createRuleImage();var d=this.getOption("amount",
255),b=this.getOption("repeat",!1),c=a.width,e=a.height,f=this.ruleImage.width,j=this.ruleImage.height;a=a.data;var n=this.ruleImage.data,l;this.opt.mask1&&this.opt.mask2&&(l=this.mask?this.mask:this.createMask());if(c==f&&e==j){c=0;for(e=a.length;c<e>>2;c++)b=c<<2,l&&l[b]?this.opt.maskDraw||(a[b+3]=0):a[b+3]=Math.round(a[b+3]/255*Math.max(0,n[b]-d))}else if(b)for(var s=0;s<c;s++)for(var k=0;k<e;k++)if(b=4*(s+k*c),l&&l[b])this.opt.maskDraw||(a[b+3]=0);else{var t=s%f,u=k%j,t=4*(t+u*f);a[b+3]=Math.round(a[b+
3]/255*Math.max(0,n[t]-d))}else for(var x=Math.round(100*(f/c))/100,j=Math.round(100*(j/e))/100,s=0;s<c;s++)for(k=0;k<e;k++)b=4*(s+k*c),l&&l[b]?this.opt.maskDraw||(a[b+3]=0):(t=Math.round(x*s),u=Math.round(j*k),t=4*(t+u*f),a[b+3]=Math.round(a[b+3]/255*Math.max(0,n[t]-d)))};c.UniversalTransitionFilter=b;a=function(){b.apply(this,arguments)};__extends(a,b);a.prototype.createImageData=function(a,d){return window.createCanvas(a,d).getContext("2d").createImageData(a,d)};a.prototype.createRuleImage=function(){b.prototype.createRuleImage.call(this);
for(var a=this.ruleImage.data,d=0,c=a.length;d<c>>2;d++){var e=d<<2;a[e]=255-a[e];a[e+1]=255-a[e+1];a[e+2]=255-a[e+2]}};c.ReverseUniversalTransitionFilter=a;a=function(a,b){d.call(this,a);this.opt.opacity=b};__extends(a,d);a.prototype.filter=function(a){var d=this.getOption("opacity",1);a=a.data;for(var b=0,c=a.length;b<c>>2;b++){var e=b<<2,f=a[e],j=a[e+1],n=a[e+2],l=0.21*f+0.71*j+0.07*n;a[e]=this.findColorDifference(d,l,f);a[e+1]=this.findColorDifference(d,l,j);a[e+2]=this.findColorDifference(d,
l,n)}};c.GreyscaleFilter=a;a=function(a,b){d.call(this,a);this.opt.opacity=b};__extends(a,d);a.prototype.filter=function(a){var d=this.getOption("opacity",1);a=a.data;for(var b=0,c=a.length;b<c>>2;b++){var e=b<<2,f=a[e],j=a[e+1],n=a[e+2];a[e]=this.findColorDifference(d,0.393*f+0.769*j+0.189*n,f);a[e+1]=this.findColorDifference(d,0.349*f+0.686*j+0.168*n,j);a[e+2]=this.findColorDifference(d,0.272*f+0.534*j+0.131*n,n)}};c.SepiaFilter=a;a=function(a,b,c){d.call(this,a);this.opt.color=b;this.opt.opacity=
c};__extends(a,d);a.prototype.filter=function(a){var d=this.getOption("opacity",1),b=this.getOption("color","#f00");a=a.data;for(var c=parseInt(this.createColor(b),16),b=(c&16711680)>>16,e=(c&65280)>>8,c=c&255,f=0,j=a.length;f<j>>2;f++){var n=f<<2,l=a[n+1],s=a[n+2];a[n]=this.findColorDifference(d,b,a[n]);a[n+1]=this.findColorDifference(d,e,l);a[n+2]=this.findColorDifference(d,c,s)}};c.TintFilter=a;a=function(a,b){d.call(this,a);this.opt.amount=b};__extends(a,d);a.prototype.filter=function(a){this.applyMatrix(a,
[0,1,0,1,-4,1,0,1,0],this.getOption("amount",1))};c.EdgesFilter=a;a=function(a,b){d.call(this,a);this.opt.amount=b};__extends(a,d);a.prototype.filter=function(a){this.applyMatrix(a,[-2,-1,0,-1,1,1,0,1,2],this.getOption("amount",0.5))};c.EmbossFilter=a;a=function(a,b){d.call(this,a);this.opt.amount=b};__extends(a,d);a.prototype.filter=function(a){this.applyMatrix(a,[-1,-1,-1,-1,9,-1,-1,-1,-1],this.getOption("amount",0.5))};c.SharpenFilter=a;a=function(a,b,c){d.call(this,a);this.opt.amount=b;this.opt.matrix=
c};__extends(a,d);a.prototype.filter=function(a){var d=this.getOption("matrix",[0.111,0.111,0.111,0.111,0.111,0.111,0.111,0.111,0.111]);this.applyMatrix(a,d,this.getOption("amount",0.5))};c.MatrixFilter=a;a=function(a,b){d.call(this,a);this.opt.amount=b};__extends(a,d);a.prototype.filter=function(a){var d=a.width,b=d<<2,c=a.height,e=this.getOption("amount",2);if(a){a=a.data;0>e&&(e=0);for(var e=2.5<=e?0.98711*e-0.9633:0.5<=e?3.97156-4.14554*Math.sqrt(1-0.26891*e):2*e*(3.97156-4.14554*Math.sqrt(0.865545)),
f=e*e,j=f*e,n=1.57825+2.44413*e+1.4281*f+0.422205*j,e=(2.44413*e+2.85619*f+1.26661*j)/n,f=-(1.4281*f+1.26661*j)/n,j=0.422205*j/n,n=1-(e+f+j),l=0;3>l;l++)for(var s=0;s<c;s++){for(var k=s*b+l,t=s*b+(d-1<<2)+l,u=a[k],x=u,v=x,y=v;k<=t;k+=4)u=n*a[k]+e*x+f*v+j*y,a[k]=u,y=v,v=x,x=u;k=s*b+(d-1<<2)+l;t=s*b+l;for(y=v=x=u=a[k];k>=t;k-=4)u=n*a[k]+e*x+f*v+j*y,a[k]=u,y=v,v=x,x=u}for(l=0;3>l;l++)for(s=0;s<d;s++){k=(s<<2)+l;t=(c-1)*b+(s<<2)+l;for(y=v=x=u=a[k];k<=t;k+=b)u=n*a[k]+e*x+f*v+j*y,a[k]=u,y=v,v=x,x=u;k=(c-
1)*b+(s<<2)+l;t=(s<<2)+l;for(y=v=x=u=a[k];k>=t;k-=b)u=n*a[k]+e*x+f*v+j*y,a[k]=u,y=v,v=x,x=u}}};c.BlurFilter=a;a=function(a,b,c){d.call(this,a);this.opt.size=b;this.opt.opacity=c};__extends(a,d);a.prototype.filter=function(a){var d=this.getOption("opacity",1),b=Math.round(this.getOption("size",5)),c=a.width,e=0;a=a.data;for(var f=a.length;e<f>>2;e++){var j=e<<2,n=a[j],l=a[j+1],s=a[j+2],k=j>>2,t=Math.floor(k/c),u=t%b,t=(k-t*c)%b;u&&(k-=u*c);t&&(k-=t);k<<=2;a[j]=this.findColorDifference(d,a[k],n);a[j+
1]=this.findColorDifference(d,a[k+1],l);a[j+2]=this.findColorDifference(d,a[k+2],s)}};c.MosaicFilter=a;a=c.NoiseType||(c.NoiseType={});a._map=[];a._map[0]="Mono";a.Mono=0;a._map[1]="Color";a.Color=1;var f=c.NoiseType,a=function(a,b,c){d.call(this,a);this.opt.amount=b;this.opt.type=c};__extends(a,d);a.prototype.filter=function(a){var d=this.getOption("amount",30),b=this.getOption("type",f.Mono),c=(d>>1)-1,d=c-d,e=0;a=a.data;for(var w=a.length;e<w>>2;e++){var j=e<<2,n=a[j],l=a[j+1],s=a[j+2];if(b==f.Mono){var k=
this.game.random(d,c);a[j]=this.checkRGBBoundary(n+k);a[j+1]=this.checkRGBBoundary(l+k);a[j+2]=this.checkRGBBoundary(s+k)}else a[j]=this.checkRGBBoundary(n+this.game.random(d,c)),a[j+1]=this.checkRGBBoundary(l+this.game.random(d,c)),a[j+2]=this.checkRGBBoundary(s+this.game.random(d,c))}};c.NoiseFilter=a;a=function(a,b,c){d.call(this,a);this.opt.opacity=c;this.opt.amount=b};__extends(a,d);a.prototype.filter=function(a){var d=this.getOption("opacity",1),b=this.getOption("amount",2),c=256/b,b=255/(b-
1),e=0;a=a.data;for(var f=a.length;e<f>>2;e++){var j=e<<2,n=a[j],l=a[j+1],s=a[j+2];a[j]=this.findColorDifference(d,Math.round(b*Math.round(n/c)),n);a[j+1]=this.findColorDifference(d,Math.round(b*Math.round(l/c)),l);a[j+2]=this.findColorDifference(d,Math.round(b*Math.round(s/c)),s)}};c.PosterizeFilter=a})(jg||(jg={}));
(function(e){var c=function(a){this.added_to_timeline=new e.Trigger;this.removed_from_timeline=new e.Trigger;this.action_tick=new e.Trigger;this.time=null;this.frame=0;if(a)for(var d in a)a.hasOwnProperty(d)&&null!=a[d]&&(this[d]=a[d]);this.entity=this.timeline=null;this.removed_from_timeline.handle(this,this.removedFromTimeline);this.added_to_timeline.handle(this,this.addedToTimeline);this.action_tick.handle(this,this.actionTick)};c.prototype.removedFromTimeline=function(){this.entity=this.timeline=
null;this.frame=0};c.prototype.addedToTimeline=function(a){this.timeline=a.timeline;this.entity=a.timeline.entity;this.frame=0};c.prototype.actionTick=function(a){var d=this.time-(this.frame+a.elapsed);null!=this.time&&0>=d?(this.frame=this.time,a.timeline.next(-d)):this.frame+=a.elapsed};e.Action=c})(jg||(jg={}));
(function(e){var c=e.Action,a=function(a){c.call(this,a);this.actions=[];this.endedActions=[];this.action_start=new e.Trigger;this.action_start.handle(this,this.parallelActionStart)};__extends(a,c);a.prototype.addedToTimeline=function(a){c.prototype.addedToTimeline.call(this,a);for(var b=0,e=this.actions.length;b<e;b++)this.actions[b].added_to_timeline.fire(a)};a.prototype.removedFromTimeline=function(){c.prototype.removedFromTimeline.call(this);this.actions=this.endedActions;this.endedActions=[]};
a.prototype.actionTick=function(a){c.prototype.actionTick.call(this,a);var b=this,e,g,r={timeline:{next:function(){var a=b.actions[e];b.actions.splice(e--,1);g=b.actions.length;b.endedActions.push(a);a.action_end&&a.action_end.fire({timeline:this});a.removed_from_timeline.fire({timeline:this})}},elapsed:a.elapsed};e=0;for(g=this.actions.length;e<g;e++)this.actions[e].action_tick.fire(r);0===this.actions.length&&a.timeline.next(1)};a.prototype.parallelActionStart=function(a){for(var b=0,c=this.actions.length;b<
c;b++)this.actions[b].action_start&&this.actions[b].action_start.fire(a)};e.ParallelAction=a})(jg||(jg={}));
(function(e){e.TWEEN_DRAW_OPTION_SETTERS={};var c=e.Action,a=function(a){c.call(this,a);this.origin={};this.target={};this.old={};this.props={};var b="frame easing time callback onactiontick onactionstart onactionend".split(" "),f;for(f in a)-1===b.indexOf(f)&&(this.props[f]=a[f]);null==this.easing&&(this.easing=function(a,d,b,c){return b*a/c+d});this.action_start=new e.Trigger;this.action_start.handle(this,this.actionStart);this.action_tick.handleInsert(0,this,this.tweenActionTick)};__extends(a,
c);a.prototype.actionStart=function(){for(var a in this.props)if("filter"==a){var b=new this.props[a].targetClass(this.entity.scene.game);this.entity.filter||(this.entity.filter=new e.ImageFilter.FilterChain);this.entity.filter.add(b);this.props[a].autoDelete&&this.removed_from_timeline.handleInsert(0,this,function(){this.entity.filter&&(this.entity.filter.remove(b),0==this.entity.filter.count()&&delete this.entity.filter,this.entity.updated())});this.target[a]={};this.origin[a]={};this.old[a]={};
for(var c in this.props[a])if(!("targetClass"==c||"autoDelete"==c))if(void 0!==this.props[a][c].start&&this.props[a][c].start!=e.E.prototype.start){var g=this.props[a][c].start;b.opt[c]=g;this.origin[a][c]=g;this.old[a][c]=g;this.target[a][c]=this.props[a][c].end}else b.opt[c]=this.props[a][c];this.otherTarget=b}else if(!e.TWEEN_DRAW_OPTION_SETTERS[a]&&"object"===typeof this.props[a]){this.target[a]={};this.origin[a]={};this.old[a]={};for(c in this.props[a])this.target[a][c]="function"===typeof this.props[a][c]?
this.props[a][c].call(this.entity):this.props[a][c],this.origin[a][c]=this.entity[a][c],this.old[a][c]=this.entity[a][c];this.otherTarget=this.entity[a]}else this.target[a]="function"===typeof this.props[a]?this.props[a].call(this.entity):this.props[a],this.origin[a]=e.TWEEN_DRAW_OPTION_SETTERS[a]?this.entity.getDrawOption(a):this.entity[a],this.old[a]=this.origin[a]};a.prototype.tweenActionTick=function(a){a=0===this.time?1:this.easing(Math.min(this.time,this.frame+a.elapsed),0,1,this.time)-this.easing(this.frame,
0,1,this.time);for(var b in this.target)if(void 0!==this[b])if(e.TWEEN_DRAW_OPTION_SETTERS[b])this.old[b]=(0,e.TWEEN_DRAW_OPTION_SETTERS[b])(this.entity,b,this.old[b],this.target[b],this.origin[b],a);else if("filter"==b)for(var c in this.target[b])this.otherTarget.opt[c]=this.old[b][c]+(this.target[b][c]-this.origin[b][c])*a,1E-7>Math.abs(this.otherTarget.opt[c])&&(this.otherTarget.opt[c]=0),this.old[b][c]=this.otherTarget.opt[c];else if(this.otherTarget)for(c in this.target[b])this.otherTarget[c]=
this.old[b][c]+(this.target[b][c]-this.origin[b][c])*a,1E-7>Math.abs(this.otherTarget[c])&&(this.otherTarget[c]=0),this.old[b][c]=this.otherTarget[c];else this.entity[b]=this.old[b]+(this.target[b]-this.origin[b])*a,1E-7>Math.abs(this.entity[b])&&(this.entity[b]=0),this.old[b]=this.entity[b];this.entity.updated()};e.Tween=a})(jg||(jg={}));
for(var p in jg.ENTITY_OPTIONS_DEFAULT_VALUES)"object"==typeof jg.ENTITY_OPTIONS_DEFAULT_VALUES[p]?"translate"==p?jg.TWEEN_DRAW_OPTION_SETTERS[p]=function(e,c,a,d,b,f){a={x:a.x+(d.x-b.x)*f,y:a.y+(d.y-b.y)*f};e.setDrawOption(c,a);return a}:"transform"==p?jg.TWEEN_DRAW_OPTION_SETTERS[p]=function(){throw"unsupported transform tween";}:"scale"==p&&(jg.TWEEN_DRAW_OPTION_SETTERS[p]=function(e,c,a,d,b,f){a={x:a.x+(d.x-b.x)*f,y:a.y+(d.y-b.y)*f};e.setDrawOption(c,a);return a}):jg.TWEEN_DRAW_OPTION_SETTERS[p]=
function(e,c,a,d,b,f){a+=(d-b)*f;1E-7>Math.abs(a)&&(a=0);e.setDrawOption(c,a);return a};
(function(e){var c=function(a){this.entity=a;this.queue=[];this.looped=this.paused=!1;this._parallel=null;this._activated=!1};c.prototype._deactivateTimeline=function(a){var d=this;if(a||this._activated)this._activated=!1,this.entity.scene?this.entity.scene.game.update.remove(this,this.tick):this.entity.addActiveQueue(function(){d.entity.scene.game.update.remove(d,d.tick)})};c.prototype._activateTimeline=function(a){var d=this;if(a||!this._activated&&!this.paused)this.entity.scene?this.entity.scene.game.update.handle(this,
this.tick):this.entity.addActiveQueue(function(){d.entity.scene.game.update.handle(d,d.tick)}),this._activated=!0};c.prototype.setFrameBased=function(){this.isFrameBased=!0};c.prototype.setTimeBased=function(){this.isFrameBased=!1};c.prototype.next=function(a){var d=this.queue.shift();d&&(d.action_end&&d.action_end.fire({timeline:this}),0===this.queue.length&&!this.looped?(d.removed_from_timeline.fire({timeline:this}),this._deactivateTimeline(!0)):(this.looped?(d.removed_from_timeline.fire({timeline:this}),
d.frame=0,this.add(d)):d.removed_from_timeline.fire({timeline:this}),(0<a||this.queue[0]&&0===this.queue[0].time)&&this.tick(a)))};c.prototype.tick=function(a){if(!this.paused&&0<this.queue.length){var d=this.queue[0];0===d.frame&&d.action_start&&d.action_start.fire({timeline:this});d.action_tick.fire({timeline:this,elapsed:this.isFrameBased?1:a})}};c.prototype.add=function(a){this._activated||this._activateTimeline(!0);this._parallel?(this._parallel.actions.push(a),this._parallel=null):this.queue.push(a);
a.frame=0;a.added_to_timeline.fire({timeline:this});return this};c.prototype.action=function(a){return this.add(new e.Action(a))};c.prototype.tween=function(a){return this.add(new e.Tween(a))};c.prototype.clear=function(){for(var a=0,d=this.queue.length;a<d;a++)this.queue[a].removed_from_timeline.fire({timeline:this});this.queue=[];this._deactivateTimeline();return this};c.prototype.skip=function(a){var d={};this.isFrameBased?d.elapsed=1:(d.elapsed=a,a=1);for(;a--;)this.tick(d);return this};c.prototype.pause=
function(){this.paused||(this.paused=!0,this._deactivateTimeline());return this};c.prototype.resume=function(){this.paused&&(this.paused=!1,this._activateTimeline());return this};c.prototype.loop=function(){this.looped=!0;return this};c.prototype.unloop=function(){this.looped=!1;return this};c.prototype.delay=function(a){this.add(new e.Action({time:a}));return this};c.prototype.then=function(a){var d=this,b=new e.Action({time:0});b.action_tick.handleInsert(0,b,function(b){a.call(d.entity,b)});this.add(b);
return this};c.prototype.exec=function(a){this.then(a)};c.prototype.frame=function(a,d){var b=this.entity;void 0==d?this.then(function(){b.frame=a;b.changeFrame()}):this.delay(a).then(function(){b.frame=d;b.changeFrame()});return this};c.prototype.fno=function(a,d){var b=this.entity;void 0==d?this.then(function(){b.fno=a;b.changeFrame()}):this.delay(a).then(function(){b.fno=d;b.changeFrame()});return this};c.prototype.cue=function(a){var d=0,b;for(b in a){var c=parseInt(b);a.hasOwnProperty(b)&&(this.delay(c-
d),this.then(a[b]),d=c)}};c.prototype.repeat=function(a,d){var b=new e.Action({time:d});b.action_tick.handle(b,function(d){a.call(b,d)});return this};c.prototype.and=function(){var a=this.queue.pop();if(a instanceof e.ParallelAction)this._parallel=a,this.queue.push(a);else{var d=new e.ParallelAction;d.actions.push(a);this.queue.push(d);this._parallel=d}return this};c.prototype.waitUntil=function(a){var d=this,b=new e.Action;b.action_start=new e.Trigger;b.action_tick.handle(b,function(c){a.call(b,
c)&&d.next(0)});this.add(b);return this};c.prototype.moveTo=function(a,d,b,c){return this.tween({x:a,y:d,time:b,easing:c})};c.prototype.moveX=function(a,d,b){return this.tween({x:a,time:d,easing:b})};c.prototype.moveY=function(a,d,b){return this.tween({y:a,time:d,easing:b})};c.prototype.moveBy=function(a,d,b,c){return this.tween({x:function(){return this.x+a},y:function(){return this.y+d},time:b,easing:c})};c.prototype.scrollTo=function(a,d,b,c){this.entity.scroll||this.entity.scrollTo(0,0);return this.tween({scroll:{x:a,
y:d},time:b,easing:c})};c.prototype.scrollX=function(a,d,b){this.entity.scroll||this.entity.scrollTo(0,0);return this.tween({scroll:{x:a},time:d,easing:b})};c.prototype.scrollY=function(a,d,b){this.entity.scroll||this.entity.scrollTo(0,0);return this.tween({scroll:{y:a},time:d,easing:b})};c.prototype.scrollBy=function(a,d,b,c){this.entity.scroll||this.entity.scrollTo(0,0);return this.tween({scroll:{x:function(){return this.scroll?this.scroll.x+a:a},y:function(){return this.scroll?this.scroll.y+d:
d}},time:b,easing:c})};c.prototype.fadeTo=function(a,d,b){this.tween({opacity:a,time:d,easing:b});return this};c.prototype.fadeIn=function(a,d){return this.fadeTo(1,a,d)};c.prototype.fadeOut=function(a,d){return this.fadeTo(0,a,d)};c.prototype.hide=function(){return this.then(function(){this.hide()})};c.prototype.show=function(){return this.then(function(){this.show()})};c.prototype.resizeTo=function(a,d,b,c){return"number"===typeof b?this.tween({width:a,height:d,time:b,easing:c}):this.tween({width:a,
height:a,time:d,easing:b})};c.prototype.resizeBy=function(a,d,b,c){return"number"===typeof b?this.tween({width:function(){return this.width+a},height:function(){return this.height+d},time:b,easing:c}):this.tween({width:function(){return this.width+a},height:function(){return this.height+a},time:d,easing:b})};c.prototype.scaleTo=function(a,d,b,c){return"number"===typeof b?this.tween({scale:{x:a,y:d},time:b,easing:c}):this.tween({scale:{x:a,y:a},time:d,easing:b})};c.prototype.scaleBy=function(a,d,b,
c){return"number"===typeof b?this.tween({scale:function(){var b=this.getDrawOption("scale");return{x:b.x*a,y:b.y*d}},time:b,easing:c}):this.tween({scale:function(){var d=this.getDrawOption("scale");return{x:d.x*a,y:d.y*a}},time:d,easing:b})};c.prototype.rotateTo=function(a,d,b){return this.tween({rotate:a,time:d,easing:b})};c.prototype.rotateBy=function(a,d,b){return this.tween({rotate:function(){return this.getDrawOption("rotate")+a},time:d,easing:b})};c.prototype.filter=function(a,d,b,c){a={targetClass:a,
autoDelete:!0};for(var e in d)a[e]=d[e];return this.tween({filter:a,time:b,easing:c})};c.prototype.removeFromScene=function(){return this.then(function(){this.remove()})};e.Timeline=c;c.prototype.isFrameBased=!1})(jg||(jg={}));
(function(e){var c=function(){};c.getCenterPoint=function(a){return a.width&&a.height?{x:a.x+a.width/2,y:a.y+a.height/2}:a};c.getMargin=function(a){return a.width&&a.height?{x:a.width/2,y:a.height/2}:{x:0,y:0}};c.intersect=function(a,d){return a.width&&a.height?d.width&&d.height?a.x<=d.x+d.width&&d.x<=a.x+a.width&&a.y<=d.y+d.height&&d.y<=a.y+a.height:d.x>=a.x&&d.x<=a.x+a.width&&d.y>=a.y&&d.y<=a.y+a.height:d.width&&d.height?a.x>=d.x&&a.x<=d.x+d.width&&a.y>=d.y&&a.y<=d.y+d.height:a.x==d.x&&a.y==d.y};
c.getDistance=function(a,d){var b=c.getCenterPoint(a),e=c.getCenterPoint(d);return{x:Math.abs(b.x-e.x),y:Math.abs(b.y-e.y)}};c.getMovePoint=function(a,d,b,e){a=c.getCenterPoint(a);d=c.getCenterPoint(d);b||(b=1);b={x:(a.x-d.x)*b,y:(a.y-d.y)*b};d=Math.abs(b.x);a=Math.abs(b.y);var g=Math.max(d,a),r=d/g,g=a/g;if(e&&(d>e||a>e))b.x=0>b.x?-e*r:e*r,b.y=0>b.y?-e*g:e*g;return b};c.getDirectionAngle=function(a,d,b){a=c.getCenterPoint(a);d=c.getCenterPoint(d);var f=Math.abs(a.x-d.x),g=Math.abs(a.y-d.y);return b&&
Math.max(f,g)<b?null:f>g?a.x>d.x?e.Angle.Left:e.Angle.Right:a.y>d.y?e.Angle.Up:e.Angle.Down};c.getDirectionKeytype=function(a,d,b){a=c.getCenterPoint(a);d=c.getCenterPoint(d);var f=Math.abs(a.x-d.x),g=Math.abs(a.y-d.y);return b&&Math.max(f,g)<b?null:f>g?a.x>d.x?e.Keytype.Left:e.Keytype.Right:a.y>d.y?e.Keytype.Up:e.Keytype.Down};c.homingX=function(a,d,b,e){var g=c.getMargin(a),r=c.getMargin(d);d=d.x+r.x-g.x;return a.x>d?(a.x-=b*e,a.x<d?(a.x=d,!0):!1):a.x<d?(a.x+=b*e,a.x>d?(a.x=d,!0):!1):!0};c.homingY=
function(a,d,b,e){var g=c.getMargin(a),r=c.getMargin(d);d=d.y+r.y-g.y;return a.y>d?(a.y-=b*e,a.y<d?(a.y=d,!0):!1):a.y<d?(a.y+=b*e,a.y>d?(a.y=d,!0):!1):!0};c.homing=function(a,d,b,e){var g=c.getMargin(a),r=c.getMargin(d),h=d.x+r.x-g.x;d=d.y+r.y-g.y;var m,q;a.x>h?(a.x-=b*e,a.x<h?a.x=h:m=!0):a.x<h&&(a.x+=b*e,a.x>h?a.x=h:m=!0);a.y>d?(a.y-=b*e,a.y<d?a.y=d:q=!0):a.y<d&&(a.y+=b*e,a.y>d?a.y=d:q=!0);return m||q?!1:!0};c.orderDrawY=function(){for(var a=this.entities,d=a.length,b=1;b<d;b++)for(var c=b;0<c&&
!(a[c].y>=a[c-1].y);c--){var e=a[c];a[c]=a[c-1];a[c-1]=e}};c.createLinearGradient=function(a,d,b,c,g,r){var h=window.createCanvas(1,1).getContext("2d");"number"==typeof a&&(a=new e.Rectangle(a,d,b,c),d=g,b=r);if(void 0==b){b=[];g=1/(d.length-1);for(c=0;c<d.length;c++)b.push(c*g)}a=h.createLinearGradient(a.left,a.top,a.right,a.bottom);for(c=0;c<d.length;c++)a.addColorStop(b[c],d[c]);return a};c.createRadialGradient=function(a,d,b,c,g,r,h,m){var q=window.createCanvas(1,1).getContext("2d");"number"==
typeof a&&(a=new e.Rectangle(a,d,b,c),d=g,b=r,c=h,g=m);if(void 0==g){g=[];h=1/(c.length-1);for(r=0;r<c.length;r++)g.push(r*h)}a=q.createRadialGradient(a.left,a.top,d,a.right,a.bottom,b);for(r=0;r<c.length;r++)a.addColorStop(g[r],c[r]);return a};c.createPattern=function(a,d){return window.createCanvas(1,1).getContext("2d").createPattern(a,void 0==d?"repeat":d)};c.isTransformMode=function(){if(void 0===c.isStyleScale){var a=document.createElement("canvas");c.isStyleScale=void 0===a.style.webkitTransform}return!c.isStyleScale};
c.scaleCanvas=function(a,d){c.isTransformMode()?(a.style.webkitTransformOrigin="0 0",a.style.webkitTransform="scale("+Math.max(d.width/a.width,d.height/a.height)+")"):(a.style.width=d.width+"px",a.style.height=d.height+"px")};c.getBrowser=function(){if(c.browser)return c.browser;var a=navigator.userAgent.toLowerCase(),a=/(chrome)[ \/]([\w.]+)/.exec(a)||/(webkit)[ \/]([\w.]+)/.exec(a)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(a)||/(msie) ([\w.]+)/.exec(a)||0>a.indexOf("compatible")&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(a)||
[],d={};a[1]&&(d[a[1]]=!0,d.version=a[2]);d.chrome?d.webkit=!0:d.webkit&&(d.safari=!0);return c.browser=d};c.setCrispEdges=function(a,d){d?window.imageSmoothingEnabled=d:delete window.imageSmoothingEnabled;a.refresh()};c.proxy=function(a,d){return function(){a.apply(d,arguments)}};e.JGUtil=c})(jg||(jg={}));
(function(e){var c=e.E,a=function(a,b,e,g){c.call(this);this.x=a.x;this.y=a.y;this.p=[];this.p.push({x:a.x,y:a.y});b&&(this.p.push({x:b.x,y:b.y}),this.updateSize());e&&this.setColor(e);g&&this.setLineWidth(g)};__extends(a,c);a.prototype.setClip=function(a){(this.clip=a)?this.disableTransform=!0:delete this.disableTransform};a.prototype.updateSize=function(){for(var a=this.p[0].x,b=this.p[0].y,c=this.p[0].x,e=this.p[0].y,r=1;r<this.p.length;r++){var h=this.p[0].x+this.p[r].x,m=this.p[0].y+this.p[r].y;
a>h?a=h:c<h&&(c=h);b>m?b=m:e<m&&(e=m)}this.width=c-a;this.height=e-b};a.prototype.setColor=function(a){this.setDrawOption("strokeStyle",a);return this};a.prototype.getColor=function(){return this.getDrawOption("strokeStyle")};a.prototype.setFillColor=function(a){this.setDrawOption("fillStyle",a);return this};a.prototype.getFillColor=function(){return this.getDrawOption("fillStyle")};a.prototype.setLineWidth=function(a){this.setDrawOption("lineWidth",a);return this};a.prototype.getLineWidth=function(){return this.getDrawOption("lineWidth")};
a.prototype.setLineCap=function(a){this.setDrawOption("lineCap",a);return this};a.prototype.getLineCap=function(){return this.getDrawOption("lineCap")};a.prototype.setLineJoin=function(a){this.setDrawOption("lineJoin",a);return this};a.prototype.getLineJoin=function(){return this.getDrawOption("lineJoin")};a.prototype.setMiterLimit=function(a){this.setDrawOption("miterLimit",a);return this};a.prototype.getMiterLimit=function(){return this.getDrawOption("miterLimit")};a.prototype.setFill=function(a,
b,c,e){this.fill=a;this.setFillColor(b);void 0!==c&&(this.closePath=c);void 0!==e&&(this.stroke=e);return this};a.prototype.addLine=function(a,b){2==arguments.length&&(a={x:a,y:b});this.p.push(a);this.updateSize();return this};a.prototype.addQuadraticLine=function(a,b){this.p.push(4==arguments.length?{cp1x:arguments[0],cp1y:arguments[1],x:arguments[2],y:arguments[3]}:2==arguments.length?{cp1x:a.x,cp1y:a.y,x:b.x,y:b.y}:a);this.updateSize();return this};a.prototype.addBezierLine=function(a,b,c){this.p.push(6==
arguments.length?{cp1x:arguments[0],cp1y:arguments[1],cp2x:arguments[2],cp2y:arguments[3],x:arguments[4],y:arguments[5]}:3==arguments.length?{cp1x:a.x,cp1y:a.y,cp2x:b.x,cp2y:b.y,x:c.x,y:c.y}:a);this.updateSize();return this};a.prototype.addArc=function(a,b,c){this.p.push(5==arguments.length?{x:arguments[0],y:arguments[1],x2:arguments[2],y2:arguments[3],radius:arguments[4]}:3==arguments.length?{x:a.x,y:a.y,x2:b.x,y2:b.y,radius:c}:a);this.updateSize()};a.prototype.add=function(){if(1==arguments.length)return this.addLine.apply(this,
arguments);if(2==arguments.length)return this.addQuadraticLine.apply(this,arguments);if(3==arguments.length)return this.addBezierLine.apply(this,arguments);throw"invalid arguments";};a.prototype.draw=function(a){a.beginPath();this.clip&&(a.save(),a.translate(this.x,this.y),this.options&&this.scene.game.renderer.useDrawOption(this,a));a.moveTo(0,0);for(var c=1;c<this.p.length;c++){var e=this.p[c];void 0!==e.cp2x?a.bezierCurveTo(e.cp1x,e.cp1y,e.cp2x,e.cp2y,e.x,e.y):void 0!==e.cp1x?a.quadraticCurveTo(e.cp1x,
e.cp1y,e.x,e.y):void 0!==this.p[c].radius?(e=this.p[c],a.arcTo(e.x,e.y,e.x2,e.y2,e.radius)):a.lineTo(e.x,e.y)}this.closePath&&a.closePath();this.clip?(a.restore(),a.clip()):this.fill?(a.fill(),this.stroke&&a.stroke()):a.stroke()};e.Line=a})(jg||(jg={}));
(function(e){var c=function(a){this.method=a;this.arguments=[];for(var d=1;d<arguments.length;d++)this.arguments.push(arguments[d])};c.time=1E3;c.sceneEffect=function(d,b,r,h,m,q){b=new a(d,b,r);if(q&&(d.endScene(),d._exit))return;d.changeScene(b);b.effected.handle(d,m);if("number"==typeof h)switch(h){case e.EffectType.Fade:b.fade(c.color);break;case e.EffectType.Mosaic:b.mosaic();break;case e.EffectType.Blur:b.blur();break;case e.EffectType.SlideUp:b.slide(e.Angle.Up);break;case e.EffectType.SlideDown:b.slide(e.Angle.Down);
break;case e.EffectType.SlideLeft:b.slide(e.Angle.Left);break;case e.EffectType.SlideRight:b.slide(e.Angle.Right);break;case e.EffectType.WipeUp:b.wipe(e.Angle.Up);break;case e.EffectType.WipeDown:b.wipe(e.Angle.Down);break;case e.EffectType.WipeLeft:b.wipe(e.Angle.Left);break;case e.EffectType.WipeRight:b.wipe(e.Angle.Right);break;case e.EffectType.WipeFadeUp:b.wipeFade(e.Angle.Up);break;case e.EffectType.WipeFadeDown:b.wipeFade(e.Angle.Down);break;case e.EffectType.WipeFadeLeft:b.wipeFade(e.Angle.Left);
break;case e.EffectType.WipeFadeRight:b.wipeFade(e.Angle.Right);break;case e.EffectType.BoxOut:b.boxOut(0,c.color);break;case e.EffectType.BoxOut45:b.boxOut(45,c.color);break;case e.EffectType.BoxIn:b.boxIn(0,c.color);break;case e.EffectType.BoxIn45:b.boxIn(45,c.color);break;case e.EffectType.ArcIn:b.arcIn(c.color);break;case e.EffectType.ArcOut:b.arcOut(c.color)}else h.callEffect(b)};c.prototype.callEffect=function(a){a[this.method].apply(a,this.arguments)};e.Effect=c;var a,d=e.Scene,b=function(a,
b,c){d.call(this,a);a=this.captureScene(b);c=this.captureScene(c);c.hide();a.x=a.y=c.x=c.y=0;this.append(a);this.append(c);this.sp1=a;this.sp2=c;this.effected=new e.Trigger};__extends(b,d);b.prototype.captureScene=function(a){var d=new e.BufferedRenderer(this.game);d.renderScene(a);return d.createSprite()};b.prototype.fade=function(a){var d=this;a?this._fadeColor(a):(this.sp1.tl().fadeOut(c.time).removeFromScene(),this.sp2.tl().fadeIn(c.time).then(function(){d.effected.fire()}))};b.prototype._fadeColor=
function(a){var d=this;a=new e.Shape(this.sp1.width,this.sp1.height,e.ShapeStyle.Fill,a);a.hide();this.root.append(a);var b=c.time/2;this.sp1.tl().fadeOut(b);a.tl().fadeIn(b).fadeOut(b).removeFromScene();this.sp2.tl().delay(b).fadeIn(b).then(function(){d.effected.fire()})};b.prototype.mosaic=function(){var a=this,d=c.time/2;this.sp1.tl().filter(e.ImageFilter.MosaicFilter,{size:{start:1,end:64}},d).removeFromScene();this.sp2.tl().delay(d).show().filter(e.ImageFilter.MosaicFilter,{size:{start:64,end:1}},
d).then(function(){a.effected.fire()})};b.prototype.blur=function(){var a=this,d=c.time/2;this.sp1.tl().filter(e.ImageFilter.BlurFilter,{amount:{start:1,end:20}},d,e.Easing.CUBIC_EASEIN).removeFromScene();this.sp2.tl().delay(d).show().filter(e.ImageFilter.BlurFilter,{amount:{start:20,end:1}},d,e.Easing.CUBIC_EASEOUT).then(function(){a.effected.fire()})};b.prototype.slide=function(a){var d=this,b=c.time;switch(a){case e.Angle.Up:this.sp1.tl().moveTo(0,-this.game.height,b).removeFromScene();this.sp2.moveTo(0,
this.game.height);this.sp2.tl().show().moveTo(0,0,b);break;case e.Angle.Down:this.sp1.tl().moveTo(0,this.game.height,b).removeFromScene();this.sp2.moveTo(0,-this.game.height);this.sp2.tl().show().moveTo(0,0,b);break;case e.Angle.Left:this.sp1.tl().moveTo(-this.game.width,0,b).removeFromScene();this.sp2.moveTo(this.game.width,0);this.sp2.tl().show().moveTo(0,0,b);break;case e.Angle.Right:this.sp1.tl().moveTo(this.game.width,0,b).removeFromScene(),this.sp2.moveTo(-this.game.width,0),this.sp2.tl().show().moveTo(0,
0,b)}this.sp2.tl().then(function(){d.effected.fire()})};b.prototype.wipe=function(a){var d=this,b=c.time;this.sp2.tl().show();var h=new e.Shape(this.game.width,1,e.ShapeStyle.Fill);h.moveTo(0,0);h.setClip(!0);this.root.insert(h,1);switch(a){case e.Angle.Up:h.width=this.game.width;h.height=1;h.y=this.game.height;h.tl().resizeTo(this.game.width,this.game.height,b).and().moveTo(0,0,b);break;case e.Angle.Down:h.width=this.game.width;h.height=1;h.tl().resizeTo(this.game.width,this.game.height,b);break;
case e.Angle.Left:h.width=1;h.height=this.game.height;h.x=this.game.width;h.tl().resizeTo(this.game.width,this.game.height,b).and().moveTo(0,0,b);break;case e.Angle.Right:h.width=1,h.height=this.game.height,h.tl().resizeTo(this.game.width,this.game.height,b)}h.tl().then(function(){d.effected.fire()})};b.prototype.wipeFade=function(a){this.wipe(a);this.sp1.tl().fadeOut(c.time)};b.prototype.boxOut=function(a,d){var b=this,h=c.time;this.sp2.tl().fadeIn(h);var m=new e.Shape(1,1,e.ShapeStyle.Fill);m.moveTo(this.game.width/
2,this.game.height/2);m.setClip(!0);a&&m.setDrawOption("rotate",a);this.root.insert(m,1);if(d){var q=new e.Shape(this.game.width,this.game.height,e.ShapeStyle.Fill,d);this.root.insert(q,1);q.hide();q.tl().fadeIn(0.6*h)}a?m.tl().resizeTo(2*this.game.width,2*this.game.height,h).and().moveTo(-this.game.width/2,-this.game.height/2,h):m.tl().resizeTo(this.game.width,this.game.height,h).and().moveTo(0,0,h);m.tl().then(function(){b.effected.fire()})};b.prototype.boxIn=function(a,d){var b=this;this.swapScene();
var h=c.time;this.sp2.tl().fadeIn(h);var m=new e.Shape(1,1,e.ShapeStyle.Fill);a?(m.moveTo(-this.game.width/2,-this.game.height/2),m.width=2*this.game.width,m.height=2*this.game.height):(m.moveTo(0,0),m.width=this.game.width,m.height=this.game.height);m.setClip(!0);a&&m.setDrawOption("rotate",a);this.root.insert(m,1);if(d){var q=new e.Shape(m.width,m.height,e.ShapeStyle.Fill,d);q.moveTo(m.x,m.y);this.root.append(q);q.hide();q.tl().fadeIn(0.8*h).and().resizeTo(1,1,h).and().moveTo(this.game.width/2,
this.game.height/2,h);a&&q.setDrawOption("rotate",a)}else this.sp1.tl().fadeOut(h);m.tl().resizeTo(1,1,h).and().moveTo(this.game.width/2,this.game.height/2,h);m.tl().then(function(){b.effected.fire()})};b.prototype.arcOut=function(a){var d=this,b=c.time;this.sp2.tl().fadeIn(b);var h=new e.Shape(1,1,e.ShapeStyle.Fill,"black",e.ShapeType.Arc);h.moveTo(this.game.width/2,this.game.height/2);h.setClip(!0);this.root.insert(h,1);a&&(a=new e.Shape(this.game.width,this.game.height,e.ShapeStyle.Fill,a),this.root.insert(a,
1),a.hide(),a.tl().fadeIn(0.6*b));h.tl().resizeTo(2*this.game.width,2*this.game.height,b).and().moveTo(-this.game.width/2,-this.game.height/2,b);h.tl().then(function(){d.effected.fire()})};b.prototype.arcIn=function(a){var d=this;this.swapScene();var b=c.time;this.sp2.tl().fadeIn(b);var h=new e.Shape(1,1,e.ShapeStyle.Fill,"black",e.ShapeType.Arc);h.moveTo(-this.game.width/2,-this.game.height/2);h.width=2*this.game.width;h.height=2*this.game.height;h.setClip(!0);this.root.insert(h,1);a?(a=new e.Shape(h.width,
h.height,e.ShapeStyle.Fill,a),a.moveTo(h.x,h.y),this.root.append(a),a.hide(),a.tl().fadeIn(0.9*b).and().resizeTo(1,1,b).and().moveTo(this.game.width/2,this.game.height/2,b)):this.sp1.tl().fadeOut(b);h.tl().resizeTo(1,1,b).and().moveTo(this.game.width/2,this.game.height/2,b);h.tl().then(function(){d.effected.fire()})};b.prototype.universal=function(a,d){var b=this,h=c.time;this.swapScene();this.sp1.tl().filter(e.ImageFilter.UniversalTransitionFilter,{image:a,repeat:d,amount:{start:-255,end:255}},h).removeFromScene();
this.sp2.tl().show().delay(h).then(function(){b.effected.fire()})};b.prototype.universalTwin=function(a,d){var b=this,h=c.time;this.sp1.tl().filter(e.ImageFilter.UniversalTransitionFilter,{image:a,repeat:d,amount:{start:-255,end:255}},h).removeFromScene();this.sp2.tl().show().filter(e.ImageFilter.ReverseUniversalTransitionFilter,{image:a,repeat:d,amount:{start:255,end:-255}},h).then(function(){b.effected.fire()})};b.prototype.universalDelay=function(a,d,b){var h=this,m=c.time/2;b=new e.Shape(this.sp1.width,
this.sp1.height,e.ShapeStyle.Fill,b);b.hide();this.root.insert(b,0);this.sp1.tl().filter(e.ImageFilter.UniversalTransitionFilter,{image:a,repeat:d,amount:{start:-255,end:255}},m).removeFromScene();b.tl().fadeIn(m).delay(m).removeFromScene();this.sp2.tl().delay(m).show().filter(e.ImageFilter.UniversalTransitionFilter,{image:a,repeat:d,amount:{start:255,end:-255}},m).then(function(){h.effected.fire()})};b.prototype.getFilter=function(a){a.filter||(a.filter=new e.ImageFilter.FilterChain);return a.filter};
b.prototype.swapScene=function(){var a=this.root.entities[0];this.root.entities[0]=this.root.entities[1];this.root.entities[1]=a};a=b;e.EffectScene=a})(jg||(jg={}));
(function(e){var c=e.E,a=function(a,b,f,g){c.call(this);this.width=a;this.height=b;this.padding=g?g:new e.Rectangle(8,8,8,8);this.entities=[];f?(a=f instanceof e.E?f:new e.Sprite(f),this.setBg(this.createBgImage(a))):this.defaultSkin()};__extends(a,c);a.prototype.getBg=function(){return this.entities[0]};a.prototype.setBg=function(a){this.bg&&this.bg.remove();this.bg=a;this.insert(a,0)};a.prototype.createBgImage=function(a,b,c){c||(c=new e.BufferedRenderer(a));c.renderUnit(a);c.filter&&c.applyFilter(c.c,
c.size);b=new e.E;b.width=this.width;b.height=this.height;b.entities=[];var g=c.createSprite({x:0,y:0,width:this.padding.left,height:this.padding.top});g.moveTo(0,0);b.append(g);g=c.createSprite({x:a.width-this.padding.right,y:0,width:this.padding.right,height:this.padding.top});g.moveTo(this.width-this.padding.right,0);b.append(g);g=c.createSprite({x:a.width-this.padding.right,y:a.height-this.padding.bottom,width:this.padding.right,height:this.padding.bottom});g.moveTo(this.width-this.padding.right,
this.height-this.padding.bottom);b.append(g);g=c.createSprite({x:0,y:a.height-this.padding.bottom,width:this.padding.left,height:this.padding.bottom});g.moveTo(0,this.height-this.padding.bottom);b.append(g);g=c.createSprite({x:this.padding.left,y:0,width:a.width-this.padding.right-this.padding.left,height:this.padding.top});g.moveTo(this.padding.left,0);g.width=this.width-this.padding.right-this.padding.left;b.append(g);g=c.createSprite({x:a.width-this.padding.right,y:this.padding.top,width:this.padding.right,
height:a.height-this.padding.top-this.padding.bottom});g.moveTo(this.width-this.padding.right,this.padding.top);g.height=this.height-this.padding.top-this.padding.bottom;b.append(g);g=c.createSprite({x:this.padding.left,y:a.height-this.padding.bottom,width:a.width-this.padding.right-this.padding.left,height:this.padding.bottom});g.moveTo(this.padding.left,this.height-this.padding.bottom);g.width=this.width-this.padding.right-this.padding.left;b.append(g);g=c.createSprite({x:0,y:this.padding.top,width:this.padding.left,
height:a.height-this.padding.top-this.padding.bottom});g.moveTo(0,this.padding.top);g.height=this.height-this.padding.top-this.padding.bottom;b.append(g);a=c.createSprite({x:this.padding.left,y:this.padding.top,width:a.width-this.padding.left-this.padding.right,height:a.height-this.padding.top-this.padding.bottom});a.moveTo(this.padding.left,this.padding.top);a.width=this.width-this.padding.left-this.padding.right;a.height=this.height-this.padding.top-this.padding.bottom;b.append(a);return b.createSprite()};
a.prototype.defaultSkin=function(){this.bg&&this.bg.remove();var a=e.JGUtil.createLinearGradient(new e.Rectangle(0,0,this.width,this.height),["rgba(138,193,255,0.5)","rgba(222, 235, 250, 0.5)"]),b=new e.E;b.width=this.width;b.height=this.height;b.entities=[];a=new e.Shape(this.width,this.height,e.ShapeStyle.Fill,a);b.append(a);a=new e.Shape(this.width-(this.padding.left+this.padding.right)+4,this.height-(this.padding.top+this.padding.bottom)+4,e.ShapeStyle.Fill,"rgba(45,73,136,0.2)");a.moveTo(this.padding.left-
2,this.padding.top-2);b.append(a);this.setBg(b.createSprite())};e.UIWindow=a})(jg||(jg={}));
(function(e){var c=e.UIWindow,a=function(a,b,f,g){c.call(this,a,b,f,g);this.normalSpeed=400;this.fastSpeed=800;this.readed=new e.Trigger;this.isReaded=!0;this.hasNextCursor=!1;a=new e.MultilineText({width:this.width-this.padding.left-this.padding.right,height:this.height-this.padding.top-this.padding.bottom},{x:this.padding.left,y:this.padding.top});this.setTextArea(a);a=new e.Line({x:0,y:0},{x:6,y:8});a.addLine(12,0);a.closePath=!0;a.fill=!0;a.setFillColor("rgba(255, 255, 255, 0.8)");a.width=12;
a.height=8;this.nextCursor=a};__extends(a,c);a.prototype.setTextArea=function(a){this.textArea&&(this.textArea.remove(),this.textClip.remove());a.animated.handle(this,this.onAnimated);this.textArea=a;this.textClip=new e.Shape(this.width,this.height);this.textClip.setClip(!0);this.textClip.moveTo(a.x,a.y);this.append(this.textClip);this.append(a)};a.prototype.getNextCursor=function(){return this.nextCursor};a.prototype.setNextCursor=function(a){this.nextCursor=a};a.prototype.setText=function(a,b){var c=
this.textArea;this.scriptOffset=c.setText(a,b);this.script=c.script;c.hideAll();this.deleteNextCursor();this.isReaded=!1;return this.scriptOffset};a.prototype.setScript=function(a,b){var c=this.textArea;this.script=a;this.scriptOffset=c.setScript(a,b);c.hideAll();this.deleteNextCursor();this.isReaded=!1;return this.scriptOffset};a.prototype.showNextCursor=function(){if(!this.hasNextCursor){var a=this.nextCursor.createSprite();a.moveTo(this.width/2-a.width/2,this.height-a.height-this.padding.bottom-
4);a.tl().moveBy(0,4,500).moveBy(0,-4,500).delay(500).loop();this.append(a);this.hasNextCursor=!0;this._nextCursor=a}};a.prototype.deleteNextCursor=function(){this.hasNextCursor&&(this._nextCursor.remove(),delete this._nextCursor,this.hasNextCursor=!1)};a.prototype.hide=function(a){a?this.tl().fadeOut(200):c.prototype.hide.call(this)};a.prototype.show=function(a){a?this.tl().fadeIn(200):c.prototype.show.call(this)};a.prototype.showText=function(){this.textArea.startAnimation()};a.prototype.fastMode=
function(){this.textArea.animeSpeed=this.fastSpeed};a.prototype.normalMode=function(){this.textArea.animeSpeed=this.normalSpeed};a.prototype.showAll=function(){this.textArea.showAll()};a.prototype.next=function(){if(0>this.scriptOffset)return!1;this.oldWipeOut();this.setScript(this.script,this.scriptOffset);this.textArea.startAnimation()};a.prototype.oldWipeOut=function(a){void 0===a&&(a=800);var b=this.textArea,c=b.createSprite();c.moveTo(b.x,b.y);this.append(c);var e=b.lines[b.lines.length-1],e=
e.offsetY+e.height;b.moveTo(b.x,b.y+e);c.tl().moveBy(0,-b.height,a).removeFromScene();b.tl().moveBy(0,-e,e/b.height*a)};a.prototype.oldFadeOut=function(a){void 0===a&&(a=500);var b=this.textArea,c=b.createSprite();c.moveTo(b.x,b.y);this.append(c);c.tl().fadeOut(a).removeFromScene()};a.prototype.onAnimated=function(){var a=0<=this.scriptOffset;a&&this.showNextCursor();this.isReaded=!0;this.readed.fire(a)};e.MessageWindow=a})(jg||(jg={}));
(function(e){var c=e.E,a=function(a,b,f,g){c.call(this);this.y=this.x=0;this.width=a;this.height=b;var r=window.createCanvas(this.width,this.height).getContext("2d");if(f){var h=f;f instanceof e.E&&(h=f.createSprite().image);g?r.drawImage(h,0,0,a,b):r.drawImage(h,0,0)}this.imageData=r.getImageData(0,0,this.width,this.height);this.disableTransform=!0};__extends(a,c);a.prototype.clear=function(a,b,c,e){void 0===a&&(a=0);void 0===b&&(b=0);void 0===c&&(c=0);void 0===e&&(e=0);for(var r=0,h=this.imageData.data.length;r<
h;r+=4)this.imageData.data[r]=a,this.imageData.data[r+1]=b,this.imageData.data[r+2]=c,this.imageData.data[r+3]=e};a.prototype.draw=function(a){a.putImageData(this.imageData,this.x,this.y)};e.Pixel=a})(jg||(jg={}));(function(e){e.globalize=function(){for(var c in e)window[c]=e[c]}})(jg||(jg={}));